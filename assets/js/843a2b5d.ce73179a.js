"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[4674],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>g});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var o=a.createContext({}),p=function(e){var t=a.useContext(o),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(o.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,o=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),c=p(n),m=r,g=c["".concat(o,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(g,l(l({ref:t},u),{},{components:n})):a.createElement(g,l({ref:t},u))}));function g(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=m;var s={};for(var o in t)hasOwnProperty.call(t,o)&&(s[o]=t[o]);s.originalType=e,s[c]="string"==typeof e?e:r,l[1]=s;for(var p=2;p<i;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},5912:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var a=n(7462),r=(n(7294),n(3905));const i={title:"Parallelization",sidebar_position:20},l=void 0,s={unversionedId:"guides/cloud/smart-orchestration/parallelization",id:"guides/cloud/smart-orchestration/parallelization",title:"Parallelization",description:"What you'll learn",source:"@site/docs/guides/cloud/smart-orchestration/parallelization.mdx",sourceDirName:"guides/cloud/smart-orchestration",slug:"/guides/cloud/smart-orchestration/parallelization",permalink:"/cypress-documentation/guides/cloud/smart-orchestration/parallelization",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/cloud/smart-orchestration/parallelization.mdx",tags:[],version:"current",lastUpdatedAt:1702622965,formattedLastUpdatedAt:"Dec 15, 2023",sidebarPosition:20,frontMatter:{title:"Parallelization",sidebar_position:20},sidebar:"guides",previous:{title:"Overview",permalink:"/cypress-documentation/guides/cloud/smart-orchestration/overview"},next:{title:"Load Balancing",permalink:"/cypress-documentation/guides/cloud/smart-orchestration/load-balancing"}},o={},p=[{value:"Overview",id:"Overview",level:2},{value:"Splitting up your test suite",id:"Splitting-up-your-test-suite",level:2},{value:"Turning on parallelization",id:"Turning-on-parallelization",level:2},{value:"CI parallelization interactions",id:"CI-parallelization-interactions",level:2},{value:"Parallelization process",id:"Parallelization-process",level:3},{value:"Example",id:"Example",level:2},{value:"Without parallelization",id:"Without-parallelization",level:3},{value:"With parallelization",id:"With-parallelization",level:3},{value:"Grouping test runs",id:"Grouping-test-runs",level:2},{value:"Grouping by browser",id:"Grouping-by-browser",level:3},{value:"Grouping to label parallelization",id:"Grouping-to-label-parallelization",level:3},{value:"Grouping by spec context",id:"Grouping-by-spec-context",level:3},{value:"Linking CI machines for parallelization or grouping",id:"Linking-CI-machines-for-parallelization-or-grouping",level:2},{value:"CI Build ID environment variables by provider",id:"CI-Build-ID-environment-variables-by-provider",level:3},{value:"Run completion delay",id:"Run-completion-delay",level:2},{value:"Visualizing parallelization and groups in Cypress Cloud",id:"Visualizing-parallelization-and-groups-in-Cypress-Cloud",level:2},{value:"Timeline View",id:"Timeline-View",level:3},{value:"Bar Chart View",id:"Bar-Chart-View",level:3},{value:"Machines View",id:"Machines-View",level:3},{value:"Next Steps",id:"Next-Steps",level:2}],u=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},c=u("Icon"),d=u("DocsImage"),m={toc:p};function g(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("h2",{parentName:"admonition",id:"What-youll-learn"},(0,r.kt)(c,{name:"graduation-cap",mdxType:"Icon"})," What you'll learn"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"How to parallelize test runs"),(0,r.kt)("li",{parentName:"ul"},"How to group test runs"),(0,r.kt)("li",{parentName:"ul"},"Strategies for grouping test runs"),(0,r.kt)("li",{parentName:"ul"},"How load-balancing of tests works"),(0,r.kt)("li",{parentName:"ul"},"What test insights are available on Cypress Cloud"))),(0,r.kt)("h2",{id:"Overview"},"Overview"),(0,r.kt)("p",null,"If your project has a large number of tests, it can take a long time for tests\nto complete running serially on one machine. Running tests in parallel across\nmany virtual machines can save your team time and money when running tests in\nContinuous Integration (CI)."),(0,r.kt)("p",null,"Cypress can run recorded tests in parallel across multiple machines. While\nparallel tests can also technically run on a single machine, we do not recommend\nit since this machine would require significant resources to run your tests\nefficiently."),(0,r.kt)("p",null,"This guide assumes you already have your project running and\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/getting-started#Setup"},"recording")," within Continuous Integration.\nIf you have not set up your project yet, check out our\n",(0,r.kt)("a",{parentName:"p",href:"/guides/continuous-integration/introduction"},"Continuous Integration guide"),". If\nyou are running or planning to run tests across multiple browsers (Firefox,\nChrome, or Edge), we also recommend checking out our\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/cross-browser-testing"},"Cross Browser Testing guide")," for helpful\nCI strategies when using parallelization."),(0,r.kt)(d,{src:"/img/guides/parallelization/parallelization-diagram.png",alt:"Parallelization Diagram",mdxType:"DocsImage"}),(0,r.kt)("h2",{id:"Splitting-up-your-test-suite"},"Splitting up your test suite"),(0,r.kt)("p",null,"Cypress' parallelization strategy is file-based, so in order to utilize\nparallelization, your tests will need to be split across separate files."),(0,r.kt)("p",null,"Cypress will assign each spec file to an available machine based on our\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/smart-orchestration/load-balancing#Balance-strategy"},"balance strategy"),".\nDue to this balance strategy, the run order of the spec files is not guaranteed\nwhen parallelized."),(0,r.kt)("h2",{id:"Turning-on-parallelization"},"Turning on parallelization"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Refer to your CI provider's documentation on how to set up multiple machines\nto run in your CI environment.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Once multiple machines are available within your CI environment, you can pass\nthe ",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run-parallel"},"--parallel")," key to\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run"},"cypress run")," to have your recorded\ntests parallelized."))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --key=abc123 --parallel\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Running tests in parallel requires the\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run"},(0,r.kt)("inlineCode",{parentName:"a"},"--record")," flag")," be passed. This\nensures Cypress can properly collect the data needed to parallelize future runs.\nThis also gives you the full benefit of seeing the results of your parallelized\ntests in ",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/introduction"},"Cypress Cloud"),". If you have not set up\nyour project to record, check out our\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/getting-started#Setup"},"setup guide"),".")),(0,r.kt)("h2",{id:"CI-parallelization-interactions"},"CI parallelization interactions"),(0,r.kt)("p",null,"During parallelization mode, ",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/introduction"},"Cypress Cloud"),"\ninteracts with your CI machines to orchestrate the parallelization of a test run\nvia ",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/smart-orchestration/load-balancing"},"load-balancing")," of specs\nacross available CI machines by the following process:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"CI machines contact ",(0,r.kt)("a",{parentName:"li",href:"/guides/cloud/introduction"},"Cypress Cloud")," to indicate\nwhich spec files to run in the project."),(0,r.kt)("li",{parentName:"ol"},"A machine opts in to receiving a spec file to run by contacting Cypress."),(0,r.kt)("li",{parentName:"ol"},"Upon receiving requests from a CI machine, Cypress calculates the estimated\nduration to test each spec file."),(0,r.kt)("li",{parentName:"ol"},"Based on these estimations, Cypress distributes\n(",(0,r.kt)("a",{parentName:"li",href:"/guides/cloud/smart-orchestration/load-balancing"},"load-balances"),") spec\nfiles one-by-one to each available machine in a way that minimizes overall\ntest run time."),(0,r.kt)("li",{parentName:"ol"},"As each CI machine finishes running its assigned spec file, more spec files\nare distributed to it. This process repeats until all spec files are\ncomplete."),(0,r.kt)("li",{parentName:"ol"},"Upon completion of all spec files, Cypress\n",(0,r.kt)("a",{parentName:"li",href:"#Run-completion-delay"},"waits for a configurable amount of time")," before\nconsidering the test run as fully complete. This is done to better support\n",(0,r.kt)("a",{parentName:"li",href:"#Grouping-test-runs"},"grouping of runs"),".")),(0,r.kt)("p",null,"In short: each Cypress instance sends a list of the spec files to Cypress Cloud,\nwhich sends back one spec at a time to each application to run."),(0,r.kt)("h3",{id:"Parallelization-process"},"Parallelization process"),(0,r.kt)(d,{src:"/img/guides/parallelization/parallelization-overview.png",alt:"Parallelization Overview",mdxType:"DocsImage"}),(0,r.kt)("h2",{id:"Example"},"Example"),(0,r.kt)("p",null,"The examples below are from a run of our\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress-example-kitchensink"},"Kitchen Sink Example"),"\nproject. You can see the results of this run on\n",(0,r.kt)("a",{parentName:"p",href:"https://cloud.cypress.io/projects/4b7344/runs/2929/specs"},"Cypress Cloud"),"."),(0,r.kt)("h3",{id:"Without-parallelization"},"Without parallelization"),(0,r.kt)("p",null,"In this example, a single machine runs a job named ",(0,r.kt)("inlineCode",{parentName:"p"},"1x-electron"),", defined in the\nproject's\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress-example-kitchensink/blob/aabb10cc1bb9dee88e1bf28e0af5e9661427ee7a/circle.yml#L41"},"circle.yml"),"\nfile. Cypress runs all 19 spec files one by one alphabetically in this job. It\ntakes ",(0,r.kt)("strong",{parentName:"p"},"1:51")," to complete all of the tests."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"1x-electron, Machine #1\n--------------------------\n-- actions.cy.js (14s)\n-- aliasing.cy.js (1s)\n-- assertions.cy.js (1s)\n-- connectors.cy.js (2s)\n-- cookies.cy.js (2s)\n-- cypress_api.cy.js (3s)\n-- files.cy.js (2s)\n-- local_storage.cy.js (1s)\n-- location.cy.js (1s)\n-- misc.cy.js (4s)\n-- navigation.cy.js (3s)\n-- network_requests.cy.js (3s)\n-- querying.cy.js (1s)\n-- spies_stubs_clocks.cy.js (1s)\n-- traversal.cy.js (4s)\n-- utilities.cy.js (3s)\n-- viewport.cy.js (3s)\n-- waiting.cy.js (5s)\n-- window.cy.js (1s)\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Notice that when adding up the spec's run times (",(0,r.kt)("strong",{parentName:"p"},"0:55"),"), they add up to less\nthan the total time for the run to complete (",(0,r.kt)("strong",{parentName:"p"},"1:51"),") . There is extra time in\nthe run for each spec: starting the browser, encoding and uploading the video to\nthe dashboard, requesting the next spec to run.")),(0,r.kt)("h3",{id:"With-parallelization"},"With parallelization"),(0,r.kt)("p",null,"When we run the same tests with parallelization, Cypress uses its\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/smart-orchestration/load-balancing#Balance-strategy"},"load balance strategy"),"\nto order to specs to run based on the spec's previous run history. During the\nsame CI run as above, we ran ",(0,r.kt)("em",{parentName:"p"},"all")," tests again, but this time with\nparallelization across 2 machines. This job was named ",(0,r.kt)("inlineCode",{parentName:"p"},"2x-electron")," in the\nproject's\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress-example-kitchensink/blob/aabb10cc1bb9dee88e1bf28e0af5e9661427ee7a/circle.yml#L53"},"circle.yml"),"\nfile and it finished in ",(0,r.kt)("strong",{parentName:"p"},"59 seconds"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-text"},"2x-electron, Machine #1, 9 specs          2x-electron, Machine #2, 10 specs\n--------------------------------          -----------------------------------\n-- actions.cy.js (14s)                    -- waiting.cy.js (6s)\n-- traversal.cy.js (4s)                   -- navigation.cy.js (3s)\n-- misc.cy.js (4s)                        -- utilities.cy.js (3s)\n-- cypress_api.cy.js (4s)                 -- viewport.cy.js (4s)\n-- cookies.cy.js (3s)                     -- network_requests.cy.js (3s)\n-- files.cy.js (3s)                       -- connectors.cy.js (2s)\n-- location.cy.js (2s)                    -- assertions.cy.js (1s)\n-- querying.cy.js (2s)                    -- aliasing.cy.js (1s)\n-- location.cy.js (1s)                    -- spies_stubs_clocks.cy.js (1s)\n                                          -- window.cy.js (1s)\n")),(0,r.kt)("p",null,"The difference in running times and machines used is very clear when looking at\nthe ",(0,r.kt)("a",{parentName:"p",href:"#Machines-View"},"Machines View")," on Cypress Cloud. Notice how the run\nparallelized across 2 machines automatically ran all specs based on their\nduration, while the run without parallelization did not."),(0,r.kt)(d,{src:"/img/guides/parallelization/1-vs-2-machines.png",alt:"Without parallelization vs parallelizing across 2 machines",mdxType:"DocsImage"}),(0,r.kt)("p",null,"Parallelizing our tests across 2 machines saved us almost 50% of the total run\ntime, and we can further decrease the build time by adding more machines."),(0,r.kt)("h2",{id:"Grouping-test-runs"},"Grouping test runs"),(0,r.kt)("p",null,"Multiple ",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run"},"cypress run")," calls can be\nlabeled and associated to a ",(0,r.kt)("strong",{parentName:"p"},"single")," run by passing in the\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run-group-lt-name-gt"},(0,r.kt)("inlineCode",{parentName:"a"},"--group <name>")," flag"),",\nwhere ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," is an arbitrary reference label. The group name must be unique\nwithin the associated test run."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"For multiple runs to be grouped into a single run, it is required for CI\nmachines to share a common CI build ID environment variable. Typically these CI\nmachines will run in parallel or within the same build workflow or pipeline, but\n",(0,r.kt)("strong",{parentName:"p"},"it is not required to use Cypress parallelization to group runs"),". Grouping of\nruns can be utilized independently of Cypress parallelization.")),(0,r.kt)(d,{src:"/img/guides/parallelization/machines-view-grouping-expanded.png",alt:"Machines view grouping expanded",mdxType:"DocsImage"}),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("strong",null,"Cross Browser Testing"),(0,r.kt)("p",{parentName:"admonition"},"Grouping test runs with or without parallelization is a useful mechanism when\nimplementing a CI strategy for cross browser testing. Check out the\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/cross-browser-testing"},"Cross Browser Testing guide")," to learn\nmore.")),(0,r.kt)("h3",{id:"Grouping-by-browser"},"Grouping by browser"),(0,r.kt)("p",null,"You can test your application against different browsers and view the results\nunder a single run within Cypress Cloud. Below, we name our groups the same name\nas the browser being tested:"),(0,r.kt)("p",null,"The first group can be called ",(0,r.kt)("inlineCode",{parentName:"p"},"Windows/Chrome 69"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group Windows/Chrome-69 --browser chrome\n")),(0,r.kt)("p",null,"The second group can be called ",(0,r.kt)("inlineCode",{parentName:"p"},"Mac/Chrome 70"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group Mac/Chrome-70 --browser chrome\n")),(0,r.kt)("p",null,"The third group can be called ",(0,r.kt)("inlineCode",{parentName:"p"},"Linux/Electron"),". ",(0,r.kt)("em",{parentName:"p"},"Electron is the default\nbrowser used in Cypress runs"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group Linux/Electron\n")),(0,r.kt)(d,{src:"/img/guides/parallelization/browser.png",alt:"browser",mdxType:"DocsImage"}),(0,r.kt)("h3",{id:"Grouping-to-label-parallelization"},"Grouping to label parallelization"),(0,r.kt)("p",null,"We also have the power of Cypress parallelization with our groups. For the sake\nof demonstration, let's run a group to test against Chrome with 2 machines, a\ngroup to test against Electron with 4 machines, and another group to test\nagainst Electron again, but only with one machine:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group 1x-electron\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group 2x-chrome --browser chrome --parallel\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group 4x-electron --parallel\n")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"1x"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"2x"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"4x")," group prefix used here is an adopted convention to indicate\nthe level of parallelism for each run, and ",(0,r.kt)("em",{parentName:"p"},"is not required or essential"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The number of machines dedicated for each ",(0,r.kt)("inlineCode",{parentName:"p"},"cypress run")," call is based on your CI\nconfiguration for the project.")),(0,r.kt)("p",null,"Labeling these groups in this manner helps up later when we review our test runs\nin Cypress Cloud, as shown below:"),(0,r.kt)(d,{src:"/img/guides/parallelization/timeline-collapsed.png",alt:"Timeline view with grouping and parallelization",mdxType:"DocsImage"}),(0,r.kt)("h3",{id:"Grouping-by-spec-context"},"Grouping by spec context"),(0,r.kt)("p",null,"Let's say you have an application that has a ",(0,r.kt)("em",{parentName:"p"},"customer facing portal"),", ",(0,r.kt)("em",{parentName:"p"},"guest\nfacing portal")," and an ",(0,r.kt)("em",{parentName:"p"},"administration facing portal"),". You could organize and\ntest these three parts of your application within the same run:"),(0,r.kt)("p",null,"One group can be called ",(0,r.kt)("inlineCode",{parentName:"p"},"package/admin"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group package/admin --spec 'cypress/e2e/packages/admin/**/*'\n")),(0,r.kt)("p",null,"Another can be called ",(0,r.kt)("inlineCode",{parentName:"p"},"package/customer"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group package/customer --spec 'cypress/e2e/packages/customer/**/*'\n")),(0,r.kt)("p",null,"The last group can be called ",(0,r.kt)("inlineCode",{parentName:"p"},"package/guest"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --group package/guest --spec 'cypress/e2e/packages/guest/**/*'\n")),(0,r.kt)(d,{src:"/img/guides/parallelization/monorepo.png",alt:"monorepo",mdxType:"DocsImage"}),(0,r.kt)("p",null,"This pattern is especially useful for projects in a monorepo. Each segment of\nthe monorepo can be assigned its own group, and larger segments can be\nparallelized to speed up their testing."),(0,r.kt)("h2",{id:"Linking-CI-machines-for-parallelization-or-grouping"},"Linking CI machines for parallelization or grouping"),(0,r.kt)("p",null,"A CI build ID is used to associate multiple CI machines to one test run. This\nidentifier is based on environment variables that are unique to each CI build,\nand vary based on CI provider. Cypress has out-of-the-box support for most of\nthe commonly-used CI providers, so you would typically not need to directly set\nthe CI build ID via the\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run-ci-build-id-lt-id-gt"},(0,r.kt)("inlineCode",{parentName:"a"},"--ci-build-id")," flag"),"."),(0,r.kt)(d,{src:"/img/guides/parallelization/ci-build-id.png",alt:"CI Machines linked by ci-build-id",mdxType:"DocsImage"}),(0,r.kt)("h3",{id:"CI-Build-ID-environment-variables-by-provider"},"CI Build ID environment variables by provider"),(0,r.kt)("p",null,"Cypress currently uses the following CI environment variables to determine a CI\nbuild ID for a test run:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Provider"),(0,r.kt)("th",{parentName:"tr",align:null},"Environment Variable"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"AppVeyor"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"APPVEYOR_BUILD_NUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"AWS CodeBuild"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CODEBUILD_INITIATOR"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Azure Pipelines"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BUILD_BUILDNUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Bamboo"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"bamboo_buildNumber"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Bitbucket"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BITBUCKET_BUILD_NUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Buildkite"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BUILDKITE_BUILD_ID"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Circle"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CIRCLE_WORKFLOW_ID"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"CIRCLE_BUILD_NUM"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Codeship"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CI_BUILD_NUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Codeship Basic"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CI_BUILD_NUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Codeship Pro"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CI_BUILD_ID"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Drone"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"DRONE_BUILD_NUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"GitLab"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CI_PIPELINE_ID"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Jenkins"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"BUILD_NUMBER"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Semaphore"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"SEMAPHORE_EXECUTABLE_UUID"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Travis"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"TRAVIS_BUILD_ID"))))),(0,r.kt)("p",null,"You can pass a different value to link agents to the same run. For example, if\nyou are using Jenkins and think the environment variable ",(0,r.kt)("inlineCode",{parentName:"p"},"BUILD_TAG")," is more\nunique than the environment variable ",(0,r.kt)("inlineCode",{parentName:"p"},"BUILD_NUMBER"),", pass the ",(0,r.kt)("inlineCode",{parentName:"p"},"BUILD_TAG")," value\nvia CLI\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run-ci-build-id-lt-id-gt"},(0,r.kt)("inlineCode",{parentName:"a"},"--ci-build-id")," flag"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell"},"cypress run --record --parallel --ci-build-id $BUILD_TAG\n")),(0,r.kt)("h2",{id:"Run-completion-delay"},"Run completion delay"),(0,r.kt)("p",null,"During parallelization mode or when grouping runs, Cypress will wait for a\nspecified amount of time before completing the test run in case any more\nrelevant work remains. This is to compensate for various scenarios where CI\nmachines could be backed-up in a queue."),(0,r.kt)("p",null,"This waiting period is called the ",(0,r.kt)("strong",{parentName:"p"},"run completion delay")," and it begins after\nthe last known CI machine has completed as shown in the diagram below:"),(0,r.kt)(d,{src:"/img/guides/parallelization/run-completion-delay.png",alt:"Test run completion delay",mdxType:"DocsImage"}),(0,r.kt)("p",null,"This ",(0,r.kt)("strong",{parentName:"p"},"delay is 60 seconds by default"),", but is\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/account-management/projects#Run-completion-delay"},"configurable within Cypress Cloud project settings page"),"."),(0,r.kt)("h2",{id:"Visualizing-parallelization-and-groups-in-Cypress-Cloud"},"Visualizing parallelization and groups in Cypress Cloud"),(0,r.kt)("p",null,"You can see the result of each spec file that ran within\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/introduction"},"Cypress Cloud")," in the run's ",(0,r.kt)("strong",{parentName:"p"},"Specs")," tab. Specs\nare visualized within a ",(0,r.kt)("strong",{parentName:"p"},"Timeline"),", ",(0,r.kt)("strong",{parentName:"p"},"Bar Chart"),", and ",(0,r.kt)("strong",{parentName:"p"},"Machines")," view."),(0,r.kt)("h3",{id:"Timeline-View"},"Timeline View"),(0,r.kt)("p",null,"The Timeline View charts your spec files as they ran relative to each other.\nThis is especially helpful when you want to visualize how your tests ran\nchronologically across all available machines."),(0,r.kt)(d,{src:"/img/guides/parallelization/timeline-view-small.png",alt:"Timeline view with parallelization",mdxType:"DocsImage"}),(0,r.kt)("h3",{id:"Bar-Chart-View"},"Bar Chart View"),(0,r.kt)("p",null,"The Bar Chart View visualizes the ",(0,r.kt)("strong",{parentName:"p"},"duration")," of your spec files relative to\neach other."),(0,r.kt)(d,{src:"/img/guides/parallelization/bar-chart-view.png",alt:"Bar Chart view with parallelization",mdxType:"DocsImage"}),(0,r.kt)("h3",{id:"Machines-View"},"Machines View"),(0,r.kt)("p",null,"The Machines View charts spec files by the machines that executed them. This\nview enables you to evaluate the contribution of each machine to the overall\ntest run."),(0,r.kt)(d,{src:"/img/guides/parallelization/machines-view.png",alt:"Machines view with parallelization",mdxType:"DocsImage"}),(0,r.kt)("h2",{id:"Next-Steps"},"Next Steps"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/cypress-io/cypress-realworld-app"},"Cypress Real World App"),"\nruns parallelized CI jobs across multiple operating systems, browsers, and\nviewport sizes."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/guides/continuous-integration/introduction"},"Continuous Integration Guide")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/guides/guides/cross-browser-testing"},"Cross Browser Testing Guide")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.cypress.io/blog/2018/09/05/run-end-to-end-tests-on-ci-faster/"},"Blog: Run Your End-to-end Tests 10 Times Faster with Automatic Test Parallelization")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://glebbahmutov.com/blog/run-and-group-tests/"},"Blog: Run and group tests the way you want to")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/cypress-io/cypress-example-kitchensink#ci-status"},"CI Configurations in Kitchen Sink Example")),(0,r.kt)("li",{parentName:"ul"},"Slides\n",(0,r.kt)("a",{parentName:"li",href:"https://slides.com/bahmutov/cy-parallelization"},"Cypress Test Parallelization and Grouping"),"\nand ",(0,r.kt)("a",{parentName:"li",href:"https://www.youtube.com/watch?v=FfqD1ExUGlw"},"Webinar video"))))}g.isMDXComponent=!0}}]);