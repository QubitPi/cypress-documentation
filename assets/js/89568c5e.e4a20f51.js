"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[2014],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),p=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},c=function(e){var t=p(e.components);return i.createElement(l.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),d=o,h=u["".concat(l,".").concat(d)]||u[d]||m[d]||r;return n?i.createElement(h,a(a({ref:t},c),{},{components:n})):i.createElement(h,a({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,a=new Array(r);a[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,a[1]=s;for(var p=2;p<r;p++)a[p]=n[p];return i.createElement.apply(null,a)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},4412:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var i=n(7462),o=(n(7294),n(3905));const r={title:"Web Security",e2eSpecific:!0},a=void 0,s={unversionedId:"guides/guides/web-security",id:"guides/guides/web-security",title:"Web Security",description:"Browsers adhere to a strict",source:"@site/docs/guides/guides/web-security.mdx",sourceDirName:"guides/guides",slug:"/guides/guides/web-security",permalink:"/cypress-documentation/guides/guides/web-security",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/guides/web-security.mdx",tags:[],version:"current",frontMatter:{title:"Web Security",e2eSpecific:!0},sidebar:"guides",previous:{title:"Test Retries",permalink:"/cypress-documentation/guides/guides/test-retries"},next:{title:"Introduction",permalink:"/cypress-documentation/guides/continuous-integration/introduction"}},l={},p=[{value:"Examples of what Cypress does under the hood:",id:"Examples-of-what-Cypress-does-under-the-hood",level:4},{value:"Limitations",id:"Limitations",level:2},{value:"Different superdomain per test requires <code>cy.origin</code> command",id:"Different-superdomain-per-test-requires-cyorigin-command",level:3},{value:"Examples of test cases that will error without the use of <code>cy.origin</code>",id:"Examples-of-test-cases-that-will-error-without-the-use-of-cyorigin",level:4},{value:"Cross-origin iframes",id:"Cross-origin-iframes",level:3},{value:"Examples of uses for cross-origin iframes",id:"Examples-of-uses-for-cross-origin-iframes",level:4},{value:"Insecure Content",id:"Insecure-Content",level:3},{value:"Example of accessing insecure content",id:"Example-of-accessing-insecure-content",level:4},{value:"The solution",id:"The-solution",level:4},{value:"Same port per test",id:"Same-port-per-test",level:3},{value:"Common Workarounds",id:"Common-Workarounds",level:2},{value:"External Navigation",id:"External-Navigation",level:3},{value:"Form Submission Redirects",id:"Form-Submission-Redirects",level:3},{value:"JavaScript Redirects",id:"JavaScript-Redirects",level:3},{value:"Cross-Origin Errors with <code>cy.origin</code>",id:"Cross-Origin-Errors-with-cyorigin",level:3},{value:"Disabling Web Security",id:"Disabling-Web-Security",level:2},{value:"Set <code>chromeWebSecurity</code> to <code>false</code>",id:"Set-chromeWebSecurity-to-false",level:3},{value:"Set <code>chromeWebSecurity</code> to <code>false</code> in the Cypress configuration",id:"Set-chromeWebSecurity-to-false-in-the-Cypress-configuration",level:4},{value:"Modifying Obstructive Third Party Code",id:"Modifying-Obstructive-Third-Party-Code",level:2}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)},u=c("DocsImage"),m=c("CypressConfigFileTabs"),d={toc:p};function h(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Browsers adhere to a strict\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy"},"same-origin policy"),".\nThis means that browsers restrict access between ",(0,o.kt)("inlineCode",{parentName:"p"},"<iframes>")," when their origin\npolicies do not match."),(0,o.kt)("p",null,"Because Cypress works from within the browser, Cypress must be able to directly\ncommunicate with your remote application at all times. Unfortunately, browsers\nnaturally try to prevent Cypress from doing this."),(0,o.kt)("p",null,"To get around these restrictions, Cypress implements some strategies involving\nJavaScript code, the browser's internal APIs, and network proxying to ",(0,o.kt)("em",{parentName:"p"},"play by\nthe rules")," of same-origin policy. It is our goal to fully automate the\napplication under test without you needing to modify your application's code -\nand we are ",(0,o.kt)("em",{parentName:"p"},"mostly")," able to do this."),(0,o.kt)("h4",{id:"Examples-of-what-Cypress-does-under-the-hood"},"Examples of what Cypress does under the hood:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Injects\n",(0,o.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/API/Document/domain"},(0,o.kt)("inlineCode",{parentName:"a"},"document.domain")),"\ninto ",(0,o.kt)("inlineCode",{parentName:"li"},"text/html")," pages."),(0,o.kt)("li",{parentName:"ul"},"Proxies all HTTP / HTTPS traffic."),(0,o.kt)("li",{parentName:"ul"},"Changes the hosted URL to match that of the application under test."),(0,o.kt)("li",{parentName:"ul"},"Uses the browser's internal APIs for network level traffic.")),(0,o.kt)("p",null,"When Cypress first loads, the internal Cypress web application is hosted on a\nrandom port: something like ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:65874/__/"),"."),(0,o.kt)("p",null,"After the first ",(0,o.kt)("a",{parentName:"p",href:"/api/commands/visit"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.visit()"))," command is issued in a test,\nCypress changes its URL to match the origin of your remote application, thereby\nsolving the first major hurdle of same-origin policy. Your application's code\nexecutes the same as it does outside of Cypress, and everything works as\nexpected."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("strong",null,"How is HTTPS supported?"),(0,o.kt)("p",{parentName:"admonition"},"Cypress does some pretty interesting things under the hood to make testing HTTPS\nsites work. Cypress enables you to control and stub at the network level.\nTherefore, Cypress must assign and manage browser certificates to be able to\nmodify the traffic in real time."),(0,o.kt)("p",{parentName:"admonition"},"You'll notice Chrome display a warning that the 'SSL certificate does not\nmatch'. This is normal and correct. Under the hood we act as our own CA\nauthority and issue certificates dynamically in order to intercept requests\notherwise impossible to access. We only do this for the superdomain currently\nunder test, and bypass other traffic. That's why if you open a tab in Cypress to\nanother host, the certificates match as expected."),(0,o.kt)("p",{parentName:"admonition"},"Note, that Cypress allows you to optionally specify CA / client certificate\ninformation for use with HTTPS sites. See\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/client-certificates"},"Configuring client certificates"),". If\nthe remote server requests a client certificate for a configured URL, Cypress\nwill supply it.")),(0,o.kt)("h2",{id:"Limitations"},"Limitations"),(0,o.kt)("p",null,"It's important to note that although we do our ",(0,o.kt)("strong",{parentName:"p"},"very best")," to ensure your\napplication works normally inside of Cypress, there ",(0,o.kt)("em",{parentName:"p"},"are")," some limitations you\nneed to be aware of."),(0,o.kt)("h3",{id:"Different-superdomain-per-test-requires-cyorigin-command"},"Different superdomain per test requires ",(0,o.kt)("inlineCode",{parentName:"h3"},"cy.origin")," command"),(0,o.kt)("p",null,"Cypress changes its own host URL to match that of your applications. With the\nexception of ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),", Cypress requires that the URLs navigated to have the\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/cross-origin-testing#Parts-of-a-URL"},"same superdomain")," for the\nentirety of a single test."),(0,o.kt)("p",null,"If you attempt to visit two different superdomains, the ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin")," command must\nbe used to wrap Cypress commands of the second visited domain. Otherwise,\nCypress commands will timeout after the navigation and will eventually error.\nThis is because the commands that were expected to run on the second domain are\nactually being run on the first domain."),(0,o.kt)("p",null,"Without ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),", you can visit different superdomains in ",(0,o.kt)("em",{parentName:"p"},"different")," tests,\nbut not in the ",(0,o.kt)("em",{parentName:"p"},"same")," test. Please read our\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/cross-origin-testing"},"Cross Origin Testing Guide")," for more\ninformation."),(0,o.kt)("p",null,"Although Cypress tries to enforce this limitation, it is possible for your\napplication to bypass Cypress's ability to detect this."),(0,o.kt)("h4",{id:"Examples-of-test-cases-that-will-error-without-the-use-of-cyorigin"},"Examples of test cases that will error without the use of ",(0,o.kt)("inlineCode",{parentName:"h4"},"cy.origin")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"/api/commands/click"},(0,o.kt)("inlineCode",{parentName:"a"},".click()"))," an ",(0,o.kt)("inlineCode",{parentName:"li"},"<a>")," with an ",(0,o.kt)("inlineCode",{parentName:"li"},"href")," to a different\nsuperdomain with subsequent Cypress commands being run."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("a",{parentName:"li",href:"/api/commands/submit"},(0,o.kt)("inlineCode",{parentName:"a"},".submit()"))," a ",(0,o.kt)("inlineCode",{parentName:"li"},"<form>")," that causes your web server to\nredirect to you a different superdomain where additional Cypress commands are\nrun."),(0,o.kt)("li",{parentName:"ol"},"Issue a JavaScript redirect in your application, such as\n",(0,o.kt)("inlineCode",{parentName:"li"},"window.location.href = '...'"),", to a different superdomain where additional\nCypress commands are run.")),(0,o.kt)("p",null,"In each of these situations, Cypress will lose the ability to automate your\napplication and will error via command timeout unless the ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin")," command is\nused."),(0,o.kt)("p",null,"Read on to learn about\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/web-security#Common-Workarounds"},"working around these common problems"),"."),(0,o.kt)("h3",{id:"Cross-origin-iframes"},"Cross-origin iframes"),(0,o.kt)("p",null,"If your site embeds an ",(0,o.kt)("inlineCode",{parentName:"p"},"<iframe>")," that is a cross-origin frame, Cypress will not\nbe able to automate or communicate with this ",(0,o.kt)("inlineCode",{parentName:"p"},"<iframe>"),"."),(0,o.kt)("h4",{id:"Examples-of-uses-for-cross-origin-iframes"},"Examples of uses for cross-origin iframes"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Embedding a Vimeo or YouTube video."),(0,o.kt)("li",{parentName:"ul"},"Displaying a credit card form from Stripe or Braintree."),(0,o.kt)("li",{parentName:"ul"},"Displaying an embedded login form from Auth0."),(0,o.kt)("li",{parentName:"ul"},"Showing comments from Disqus.")),(0,o.kt)("p",null,"It's actually ",(0,o.kt)("em",{parentName:"p"},"possible")," for Cypress to accommodate these situations the same\nway Selenium does, but you will never have ",(0,o.kt)("em",{parentName:"p"},"native")," access to these iframes from\ninside of Cypress."),(0,o.kt)("p",null,"As a workaround, you may be able to use\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage"},(0,o.kt)("inlineCode",{parentName:"a"},"window.postMessage")),"\nto directly communicate with these iframes and control them (if the 3rd party\niframe supports it)."),(0,o.kt)("p",null,"Other than that, you'll have to wait for us to implement APIs to support this\n(check our ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress/issues/136"},"open issue"),"), or\nyou can\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/web-security#Disabling-Web-Security"},"disable web security"),"."),(0,o.kt)("h3",{id:"Insecure-Content"},"Insecure Content"),(0,o.kt)("p",null,"Because of the way Cypress is designed, if you are testing an HTTPS site,\nCypress will error anytime you attempt to navigate back to an HTTP site. This\nbehavior helps highlight a ",(0,o.kt)("em",{parentName:"p"},"pretty serious security problem")," with your\napplication."),(0,o.kt)("h4",{id:"Example-of-accessing-insecure-content"},"Example of accessing insecure content"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Test code\ncy.visit('https://app.corp.com')\n")),(0,o.kt)("p",null,"In your application code, you set ",(0,o.kt)("inlineCode",{parentName:"p"},"cookies")," and store a session on the browser.\nNow let's imagine you have a single ",(0,o.kt)("inlineCode",{parentName:"p"},"insecure")," link (or JavaScript redirect) in\nyour application code."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Application code --\x3e\n<html>\n  <a href="http://app.corp.com/page2">Page 2</a>\n</html>\n')),(0,o.kt)("p",null,"Cypress will immediately fail with the following test code:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Test code\ncy.visit('https://app.corp.com')\ncy.get('a').click() // will fail\n")),(0,o.kt)("p",null,"Browsers refuse to display insecure content on a secure page. Because Cypress\ninitially changed its URL to match ",(0,o.kt)("inlineCode",{parentName:"p"},"https://app.corp.com")," when the browser\nfollowed the ",(0,o.kt)("inlineCode",{parentName:"p"},"href")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"http://app.corp.com/page2"),", the browser will refuse to\ndisplay the contents."),(0,o.kt)("p",null,"Now you may be thinking, ",(0,o.kt)("em",{parentName:"p"},"This sounds like a problem with Cypress because when I\nwork with my application outside of Cypress it works just fine.")),(0,o.kt)("p",null,"However, the truth is, Cypress is exposing a ",(0,o.kt)("em",{parentName:"p"},"security vulnerability")," in your\napplication, and you ",(0,o.kt)("em",{parentName:"p"},"want")," it to fail in Cypress."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"cookies")," that do not have their ",(0,o.kt)("inlineCode",{parentName:"p"},"secure")," flag set to ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," will be sent as\nclear text to the insecure URL. This leaves your application vulnerable to\nsession hijacking."),(0,o.kt)("p",null,"This security vulnerability exists ",(0,o.kt)("strong",{parentName:"p"},"even if")," your web server forces a\n",(0,o.kt)("inlineCode",{parentName:"p"},"301 redirect")," back to the HTTPS site. The original HTTP request was still made\nonce, exposing insecure session information."),(0,o.kt)("h4",{id:"The-solution"},"The solution"),(0,o.kt)("p",null,"Update your HTML or JavaScript code to not navigate to an insecure HTTP page and\ninstead only use HTTPS. Additionally make sure that cookies have their ",(0,o.kt)("inlineCode",{parentName:"p"},"secure"),"\nflag set to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,o.kt)("p",null,"If you're in a situation where you don't control the code, or otherwise cannot\nwork around this, you can bypass this restriction in Cypress by\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/web-security#Disabling-Web-Security"},"disabling web security"),"."),(0,o.kt)("h3",{id:"Same-port-per-test"},"Same port per test"),(0,o.kt)("p",null,"Cypress requires that the URLs navigated to have the same port (if specified)\nfor the entirety of a single test. This matches the behavior of the browser's\nnormal\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy"},"same-origin policy"),"."),(0,o.kt)("h2",{id:"Common-Workarounds"},"Common Workarounds"),(0,o.kt)("p",null,"Let's investigate how you might encounter cross-origin errors in your test code\nand break down how to work around them in Cypress."),(0,o.kt)("h3",{id:"External-Navigation"},"External Navigation"),(0,o.kt)("p",null,"The most common situation where you might encounter this error is when you click\non an ",(0,o.kt)("inlineCode",{parentName:"p"},"<a>")," that navigates to another superdomain."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Application code that is served at `localhost:8080` --\x3e\n<html>\n  <a href="https://stackoverflow.com">Stack Overflow</a>\n</html>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Test code\ncy.visit('http://localhost:8080') // where your web server + HTML is hosted\ncy.get('a').click() // browser navigates to https://stackoverflow.com\ncy.get('selector').should('exist') // Cypress errors\n")),(0,o.kt)("p",null,"We do not recommend visiting a superdomain that you don't control in your tests\nwhich you can read more about\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/best-practices#Visiting-External-Sites"},"here")),(0,o.kt)("p",null,"However, if you control this superdomain, either by owning the hosted instance\nor by other means, we recommend testing this superdomain with ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Test code\ncy.visit('http://localhost:8080') // where your web server + HTML is hosted\ncy.get('a').click() // browser navigates to https://stackoverflow.com\ncy.origin('https://stackoverflow.com', () => {\n  // declare cy.origin command on expected domain\n  cy.get('selector').should('exist') // Yup all good\n})\n")),(0,o.kt)("p",null,"If not in control of this superdomain, like in the case of ",(0,o.kt)("inlineCode",{parentName:"p"},"stackoverflow.com"),",\nwe recommend you test that the ",(0,o.kt)("inlineCode",{parentName:"p"},"href")," property is correct instead of performing\nthe navigation. This will help lead to more deterministic tests."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// this test verifies the behavior and will run considerably faster\ncy.visit('http://localhost:8080')\ncy.get('a').should('have.attr', 'href', 'https://stackoverflow.com') // no page load!\n")),(0,o.kt)("p",null,"If for any reason the two above methods cannot be leveraged,\n",(0,o.kt)("a",{parentName:"p",href:"/api/commands/request"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.request()"))," may be an option to verify content as\n",(0,o.kt)("a",{parentName:"p",href:"/api/commands/request"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.request()"))," is ",(0,o.kt)("em",{parentName:"p"},"NOT bound to CORS or same-origin\npolicy"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.visit('http://localhost:8080')\ncy.get('a').then(($a) => {\n  // pull off the fully qualified href from the <a>\n  const url = $a.prop('href')\n\n  // make a cy.request to it\n  cy.request(url).its('body').should('include', '</html>')\n})\n")),(0,o.kt)("h3",{id:"Form-Submission-Redirects"},"Form Submission Redirects"),(0,o.kt)("p",null,"When you submit a regular HTML form, the browser will follow the HTTP(s)\nrequest."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'\x3c!-- Application code that is served at `localhost:8080`--\x3e\n<html>\n  <form method="POST" action="/submit">\n    <input type="text" name="email" />\n    <input type="submit" value="Submit" />\n  </form>\n</html>\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.visit('http://localhost:8080')\ncy.get('form').submit() // submit the form!\n")),(0,o.kt)("p",null,"If your back end server handling the ",(0,o.kt)("inlineCode",{parentName:"p"},"/submit")," route does a ",(0,o.kt)("inlineCode",{parentName:"p"},"30x")," redirect to a\ndifferent superdomain, you will need to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin")," command if running\nadditional Cypress commands after submitting the form."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// imagine this is some node / express code\n// on your localhost:8080 server\n\napp.post('/submit', (req, res) => {\n  // redirect the browser to superduperdomains.com\n  res.redirect('https://superduperdomains.com')\n})\n")),(0,o.kt)("p",null,"You can test this with ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),", which may look like the following test case:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.visit('http://localhost:8080')\ncy.get('form').submit() // submit the form!\ncy.origin('https://superduperdomains.com', () => {\n  cy.url().should('contain', 'superduperdomains.com')\n})\n")),(0,o.kt)("p",null,"A common use case for this is Single sign-on (SSO), OAuth, Open ID Connect\n(OIDC), or Authentication as a Service platforms, such as Auth0, Okta, Amazon\nCognito, and others."),(0,o.kt)("p",null,"In these situations, if controlling the domain under test, we recommend that you\ntest these with ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.visit('http://localhost:8080')\ncy.get('#login').click() // click a login button, which takes us to our authentication page.\ncy.origin('https://my-authentication-instance.com', () => {\n  cy.get('#username').type('User1')\n  cy.get('#password').type('Password123')\n\n  // prompts a sign in that redirects to http://localhost:8080 with a token, cookie, or other means of acknowledgement\n  cy.get('button').contains('Sign In').click()\n})\n\ncy.get('#user-name-welcome').should('equal', 'Welcome, User1!')\n")),(0,o.kt)("p",null,"If for any reason you cannot leverage ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),", programmatic authentication\nis still an option. In this situation you may ",(0,o.kt)("inlineCode",{parentName:"p"},"POST")," to a different server and\nare redirected elsewhere (typically with the session token in the URL). If\nthat's the case, you can still test this behavior with\n",(0,o.kt)("a",{parentName:"p",href:"/api/commands/request"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.request()")),"."),(0,o.kt)("p",null,"In fact we can likely bypass the initial visit altogether and ",(0,o.kt)("inlineCode",{parentName:"p"},"POST")," directly to\nyour SSO server."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.request('POST', 'https://sso.corp.com/auth', {\n  username: 'foo',\n  password: 'bar',\n}).then((response) => {\n  // pull out the location redirect\n  const loc = response.headers['Location']\n\n  // parse out the token from the url (assuming its in there)\n  const token = parseOutMyToken(loc)\n\n  // do something with the token that your web application expects\n  // likely the same behavior as what your SSO does under the hood\n  // assuming it handles query string tokens like this\n  cy.visit('http://localhost:8080?token=' + token)\n\n  // if you don't need to work with the token you can sometimes\n  // visit the location header directly\n  cy.visit(loc)\n})\n")),(0,o.kt)("h3",{id:"JavaScript-Redirects"},"JavaScript Redirects"),(0,o.kt)("p",null,"When we say JavaScript Redirects we are talking about any kind of code that does\nsomething like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},"\x3c!-- Application code that is served at `localhost:8080` --\x3e\n<html>\n  <button id=\"nav\">Navigate to some.superdomain.com</button>\n  <script>\n    document.querySelector('#nav').addEventListener('click', () => {\n      window.location.href = 'http://some.superdomain.com'\n    })\n  <\/script>\n</html>\n")),(0,o.kt)("p",null,"You can test this with ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),", which may look like the following test case:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.visit('http://localhost:8080')\ncy.get('#nav').submit() // trigger a javascript redirect!\ncy.origin('http://some.superdomain.com', () => {\n  cy.url().should('contain', 'some.superdomain.com')\n})\n")),(0,o.kt)("h3",{id:"Cross-Origin-Errors-with-cyorigin"},"Cross-Origin Errors with ",(0,o.kt)("inlineCode",{parentName:"h3"},"cy.origin")),(0,o.kt)("p",null,"Sometimes, when using ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin")," and especially with websites that are not\nunder your immediate test control, cross-origin errors may still tend to creep\nup. We don't recommend visiting or interacting with sites you\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/best-practices#Visiting-External-Sites"},"do not control"),".\nHowever, if this is necessary, most of these issues can usually be remedied by\napplying` the\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/experiments#Configuration"},"modify obstructive third-party code"),"\nexperimental flag or by\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/web-security#Disabling-Web-Security"},"disabling web security"),"."),(0,o.kt)("h2",{id:"Disabling-Web-Security"},"Disabling Web Security"),(0,o.kt)("p",null,"So if you cannot work around any of the issues using the suggested workarounds\nabove, including\n",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/web-security#Modifying-Obstructive-Third-Party-Code"},"modifying obstructive third-party code"),"\nwith ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.origin"),", you may want to disable web security."),(0,o.kt)("p",null,"One last thing to consider here is that every once in a while we discover bugs\nin Cypress that lead to cross-origin errors that can otherwise be fixed. If you\nthink you're experiencing a bug,\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress/issues/new/choose"},"open an issue"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("strong",null,"Chrome only"),(0,o.kt)("p",{parentName:"admonition"},"Disabling web security is only supported in Chrome-based browsers. Settings in\n",(0,o.kt)("inlineCode",{parentName:"p"},"chromeWebSecurity")," will have no effect in other browsers. We will log a warning\nin this case."),(0,o.kt)(u,{src:"/img/guides/web-security/chrome-web-security-stdout-warning.jpg",alt:"chromeWebSecurity warning in stdout",mdxType:"DocsImage"}),(0,o.kt)("p",{parentName:"admonition"},"If you rely on disabling web security, you will not be able to run tests on\nbrowsers that do not support this feature.")),(0,o.kt)("h3",{id:"Set-chromeWebSecurity-to-false"},"Set ",(0,o.kt)("inlineCode",{parentName:"h3"},"chromeWebSecurity")," to ",(0,o.kt)("inlineCode",{parentName:"h3"},"false")),(0,o.kt)("p",null,"Setting ",(0,o.kt)("inlineCode",{parentName:"p"},"chromeWebSecurity")," to ",(0,o.kt)("inlineCode",{parentName:"p"},"false")," in Chrome-based browsers allows you to do\nthe following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Display insecure content"),(0,o.kt)("li",{parentName:"ul"},"Navigate to any superdomain without cross-origin errors with or without\n",(0,o.kt)("inlineCode",{parentName:"li"},"cy.origin")),(0,o.kt)("li",{parentName:"ul"},"Access cross-origin iframes that are embedded in your application")),(0,o.kt)("p",null,"Still here? That's cool, let's disable web security!"),(0,o.kt)("h4",{id:"Set-chromeWebSecurity-to-false-in-the-Cypress-configuration"},"Set ",(0,o.kt)("inlineCode",{parentName:"h4"},"chromeWebSecurity")," to ",(0,o.kt)("inlineCode",{parentName:"h4"},"false")," in the ",(0,o.kt)("a",{parentName:"h4",href:"/guides/references/configuration"},"Cypress configuration")),(0,o.kt)("cypress-config-example",null,(0,o.kt)(m,{mdxType:"CypressConfigFileTabs"},(0,o.kt)("pre",{parentName:"cypress-config-example"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { defineConfig } = require('cypress')\n\nmodule.exports = defineConfig({\n  chromeWebSecurity: false,\n})\n")),(0,o.kt)("pre",{parentName:"cypress-config-example"},(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { defineConfig } from 'cypress'\n\nexport default defineConfig({\n  chromeWebSecurity: false,\n})\n")))),(0,o.kt)("h2",{id:"Modifying-Obstructive-Third-Party-Code"},"Modifying Obstructive Third Party Code"),(0,o.kt)("p",null,"Cypress today has the concept of\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/configuration#modifyObstructiveCode"},"modifying obstructive code"),",\nwhich is code that may interfere with Cypress being able to run your web\napplication. The ",(0,o.kt)("inlineCode",{parentName:"p"},"experimentalModifyObstructiveThirdPartyCode")," flag provides the\nsame benefits of the\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/configuration#modifyObstructiveCode"},"modifyObstructiveCode"),"\nflag, but additionally applies it to third-party ",(0,o.kt)("inlineCode",{parentName:"p"},".js")," and ",(0,o.kt)("inlineCode",{parentName:"p"},".html")," that is being\neither loaded or navigated to inside your application. In addition to this, this\nflag also does the following:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Adjusts the User Agent in Electron to appear more chrome-like. This option can\nbe overridden with the ",(0,o.kt)("a",{parentName:"li",href:"/guides/references/configuration#Browser"},"userAgent"),"\nconfig option."),(0,o.kt)("li",{parentName:"ul"},"Removes\n",(0,o.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/Security/Subresource_Integrity"},"Subresource Integrity (SRI)"),"\nfrom modified scripts as they will not execute otherwise."),(0,o.kt)("li",{parentName:"ul"},"Updates the ",(0,o.kt)("inlineCode",{parentName:"li"},"Sec-Fetch-Dest")," Metadata header from ",(0,o.kt)("inlineCode",{parentName:"li"},"iframe")," to ",(0,o.kt)("inlineCode",{parentName:"li"},"document")," in\ncases where requests come from the application under test.")),(0,o.kt)("p",null,"Want to enable ",(0,o.kt)("inlineCode",{parentName:"p"},"experimentalModifyObstructiveThirdPartyCode"),"? Let's do it!"),(0,o.kt)("cypress-config-example",null,(0,o.kt)(m,{mdxType:"CypressConfigFileTabs"},(0,o.kt)("pre",{parentName:"cypress-config-example"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { defineConfig } = require('cypress')\n\nmodule.exports = defineConfig({\n  experimentalModifyObstructiveThirdPartyCode: true,\n})\n")),(0,o.kt)("pre",{parentName:"cypress-config-example"},(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { defineConfig } from 'cypress'\n\nexport default defineConfig({\n  experimentalModifyObstructiveThirdPartyCode: true,\n})\n")))))}h.isMDXComponent=!0}}]);