"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[2636],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,p=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=o,h=d["".concat(l,".").concat(m)]||d[m]||c[m]||r;return n?a.createElement(h,s(s({ref:t},p),{},{components:n})):a.createElement(h,s({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=m;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i[d]="string"==typeof e?e:o,s[1]=i;for(var u=2;u<r;u++)s[u]=n[u];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1167:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>y,frontMatter:()=>r,metadata:()=>i,toc:()=>u});var a=n(7462),o=(n(7294),n(3905));const r={title:"Testing Your App",sidebar_position:20,slug:"/guides/end-to-end-testing/testing-your-app"},s=void 0,i={unversionedId:"guides/end-to-end-testing/introduction/testing-your-app",id:"guides/end-to-end-testing/introduction/testing-your-app",title:"Testing Your App",description:"What you'll learn",source:"@site/docs/guides/end-to-end-testing/introduction/testing-your-app.mdx",sourceDirName:"guides/end-to-end-testing/introduction",slug:"/guides/end-to-end-testing/testing-your-app",permalink:"/cypress-documentation/guides/end-to-end-testing/testing-your-app",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/end-to-end-testing/introduction/testing-your-app.mdx",tags:[],version:"current",lastUpdatedAt:1696481464,formattedLastUpdatedAt:"Oct 5, 2023",sidebarPosition:20,frontMatter:{title:"Testing Your App",sidebar_position:20,slug:"/guides/end-to-end-testing/testing-your-app"},sidebar:"guides",previous:{title:"Writing Your First E2E Test",permalink:"/cypress-documentation/guides/end-to-end-testing/writing-your-first-end-to-end-test"},next:{title:"Amazon Cognito Authentication",permalink:"/cypress-documentation/guides/end-to-end-testing/amazon-cognito-authentication"}},l={},u=[{value:'<Icon name="terminal" /> Step 1: Start your server',id:"Step-1-Start-your-server",level:2},{value:'<Icon name="globe" /> Step 2: Visit your server',id:"Step-2-Visit-your-server",level:2},{value:'<Icon name="cogs" /> Step 3: Configure Cypress',id:"Step-3-Configure-Cypress",level:2},{value:"Testing strategies",id:"Testing-strategies",level:2},{value:"Seeding data",id:"Seeding-data",level:3},{value:"Stubbing the server",id:"Stubbing-the-server",level:3},{value:"Generate the fixture stubs ahead of time",id:"Generate-the-fixture-stubs-ahead-of-time",level:4},{value:"Write a single e2e test without stubs, and then stub the rest",id:"Write-a-single-e2e-test-without-stubs-and-then-stub-the-rest",level:4},{value:"Logging in",id:"Logging-in",level:3},{value:"Fully test the login flow -- but only once!",id:"Fully-test-the-login-flow----but-only-once",level:4},{value:"Reusing the login code",id:"Reusing-the-login-code",level:4},{value:"Improving performance",id:"Improving-performance",level:4},{value:"Get started",id:"Get-started",level:2}],p=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)},d=p("Icon"),c=p("DocsVideo"),m=p("DocsImage"),h=p("CypressConfigFileTabs"),g={toc:u};function y(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},g,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("h2",{parentName:"admonition",id:"What-youll-learn"},(0,o.kt)(d,{name:"graduation-cap",mdxType:"Icon"})," What you'll learn"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"The relationship between Cypress and your back end"),(0,o.kt)("li",{parentName:"ul"},"How to configure Cypress to fit your app"),(0,o.kt)("li",{parentName:"ul"},"Working with (or without!) your authentication mechanism"),(0,o.kt)("li",{parentName:"ul"},"Effectively leveraging test data"))),(0,o.kt)(c,{src:"https://youtube.com/embed/5XQOK0v_YRE",mdxType:"DocsVideo"}),(0,o.kt)("h2",{id:"Step-1-Start-your-server"},(0,o.kt)(d,{name:"terminal",mdxType:"Icon"})," Step 1: Start your server"),(0,o.kt)("p",null,"Assuming you've successfully\n",(0,o.kt)("a",{parentName:"p",href:"/guides/getting-started/installing-cypress"},"installed Cypress")," and\n",(0,o.kt)("a",{parentName:"p",href:"/guides/getting-started/opening-the-app"},"opened Cypress")," in your project, the\nfirst thing you'll want to do is start your local development server that hosts\nthe application."),(0,o.kt)("p",null,"It should look something like ",(0,o.kt)("strong",{parentName:"p"},"http://localhost:8080"),"."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("strong",null,"Anti-Pattern"),(0,o.kt)("p",{parentName:"admonition"},"Don't try to start a web server from within Cypress scripts. Read about\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/best-practices#Web-Servers"},"best practices")," here.")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("strong",null,"Why start a local development server?"),(0,o.kt)("p",{parentName:"admonition"},"You may be wondering - why can't I just visit my application that's already in\nproduction?"),(0,o.kt)("p",{parentName:"admonition"},"While you certainly ",(0,o.kt)("em",{parentName:"p"},"can")," test an application that's already deployed, that's\nnot really the ",(0,o.kt)("strong",{parentName:"p"},"sweet spot")," of Cypress."),(0,o.kt)("p",{parentName:"admonition"},"Cypress is built, and optimized around being a tool for your daily local\ndevelopment. In fact, after you start using Cypress for awhile, we believe that\nyou may find it useful to even do ",(0,o.kt)("strong",{parentName:"p"},"all of your development")," in it."),(0,o.kt)("p",{parentName:"admonition"},"Ultimately you'll not only be able to ",(0,o.kt)("strong",{parentName:"p"},"test and develop")," at the same time, but\nyou'll actually be able to build your application ",(0,o.kt)("strong",{parentName:"p"},"faster"),' while getting tests\n"for free".'),(0,o.kt)("p",{parentName:"admonition"},"What's more - since Cypress enables you to do things like ",(0,o.kt)("strong",{parentName:"p"},"stub network\nrequests")," you can build out your web application without even needing a server\nto provide valid JSON responses."),(0,o.kt)("p",{parentName:"admonition"},"Last but not least - trying to shoehorn tests to an already built application is\nmuch more difficult than building it as you write tests. You'll likely encounter\na series of initial up front challenges / hurdles that would have otherwise been\navoided writing tests from the start."),(0,o.kt)("p",{parentName:"admonition"},"The last, and probably most important reason why you want to test against local\nservers, is the ability to ",(0,o.kt)("strong",{parentName:"p"},"control them"),". When your application is running in\nproduction you can't control it."),(0,o.kt)("p",{parentName:"admonition"},"When it's running in development you can:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"take shortcuts"),(0,o.kt)("li",{parentName:"ul"},"seed data by running executable scripts"),(0,o.kt)("li",{parentName:"ul"},"expose test environment specific routes"),(0,o.kt)("li",{parentName:"ul"},"disable security features which make automation difficult"),(0,o.kt)("li",{parentName:"ul"},"reset state on the server / database")),(0,o.kt)("p",{parentName:"admonition"},"With that said - you still have the option to have it ",(0,o.kt)("strong",{parentName:"p"},"both ways"),"."),(0,o.kt)("p",{parentName:"admonition"},"Many of our users run the ",(0,o.kt)("em",{parentName:"p"},"majority")," of their integration tests against a local\ndevelopment server, but then reserve a smaller set of ",(0,o.kt)("strong",{parentName:"p"},"smoke tests")," that run\nonly against a deployed production app.")),(0,o.kt)("h2",{id:"Step-2-Visit-your-server"},(0,o.kt)(d,{name:"globe",mdxType:"Icon"})," Step 2: Visit your server"),(0,o.kt)("p",null,"Once your server is running, it's time to visit it."),(0,o.kt)("p",null,"Let's delete the ",(0,o.kt)("inlineCode",{parentName:"p"},"sample.cy.js")," file created in the previous tutorial now that\nit's no longer needed."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"rm cypress/e2e/sample.cy.js\n")),(0,o.kt)("p",null,"Now let's create our own spec file called ",(0,o.kt)("inlineCode",{parentName:"p"},"home_page.cy.js"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"touch cypress/e2e/home_page.cy.js\n")),(0,o.kt)("p",null,"Once that file is created, you should see it in the list of spec files."),(0,o.kt)(m,{src:"/img/guides/getting-started/e2e/v10/testing-your-app-home-page-spec.png",alt:"List of files including home_page.cy.js",mdxType:"DocsImage"}),(0,o.kt)("p",null,"Now you'll need to add in the following code in your test file to visit your\nserver:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"describe('The Home Page', () => {\n  it('successfully loads', () => {\n    cy.visit('http://localhost:8080') // change URL to match your dev URL\n  })\n})\n")),(0,o.kt)("p",null,"Now click on the ",(0,o.kt)("inlineCode",{parentName:"p"},"home_page.cy.js")," file and watch Cypress open your browser."),(0,o.kt)("p",null,"If you forgot to start your server you'll see the error below:"),(0,o.kt)(m,{src:"/img/guides/getting-started/e2e/v10/testing-your-app-visit-fail.png",alt:"Error in Cypress showing cy.visit failed",mdxType:"DocsImage"}),(0,o.kt)("p",null,"If you've started your server, then you should see your application loaded and\nworking."),(0,o.kt)("h2",{id:"Step-3-Configure-Cypress"},(0,o.kt)(d,{name:"cogs",mdxType:"Icon"})," Step 3: Configure Cypress"),(0,o.kt)("p",null,"If you think ahead, you'll quickly realize that you're going to be typing this\nURL a lot, since every test is going to need to visit some page of your\napplication. Luckily, Cypress provides a\n",(0,o.kt)("a",{parentName:"p",href:"/guides/references/configuration"},"configuration option")," for this. Let's\nleverage that now."),(0,o.kt)("p",null,"Open up your ",(0,o.kt)("a",{parentName:"p",href:"/guides/references/configuration"},"configuration file"),". It starts\nout empty, but let's add the ",(0,o.kt)("inlineCode",{parentName:"p"},"baseUrl")," option."),(0,o.kt)("cypress-config-example",null,(0,o.kt)(h,{mdxType:"CypressConfigFileTabs"},(0,o.kt)("pre",{parentName:"cypress-config-example"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const { defineConfig } = require('cypress')\n\nmodule.exports = defineConfig({\n  e2e: {\n    baseUrl: 'http://localhost:8080',\n  },\n})\n")),(0,o.kt)("pre",{parentName:"cypress-config-example"},(0,o.kt)("code",{parentName:"pre",className:"language-typescript"},"import { defineConfig } from 'cypress'\n\nexport default defineConfig({\n  e2e: {\n    baseUrl: 'http://localhost:8080',\n  },\n})\n")))),(0,o.kt)("p",null,"This will automatically ",(0,o.kt)("strong",{parentName:"p"},"prefix")," ",(0,o.kt)("a",{parentName:"p",href:"/api/commands/visit"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.visit()"))," and\n",(0,o.kt)("a",{parentName:"p",href:"/api/commands/request"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.request()"))," commands with this baseUrl."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Whenever you modify your configuration file, Cypress will automatically reboot\nitself and kill any open browsers. This is normal. Click on the spec file again\nto relaunch the browser.")),(0,o.kt)("p",null,"We can now visit a relative path and omit the hostname and port."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"describe('The Home Page', () => {\n  it('successfully loads', () => {\n    cy.visit('/')\n  })\n})\n")),(0,o.kt)("p",null,"Great! Everything should still be green."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("strong",null,"Configuration Options"),(0,o.kt)("p",{parentName:"admonition"},"Cypress has many more configuration options you can use to customize its\nbehavior. Things like where your tests live, default timeout periods,\nenvironment variables, which reporter to use, etc."),(0,o.kt)("p",{parentName:"admonition"},"Check them out in ",(0,o.kt)("a",{parentName:"p",href:"/guides/references/configuration"},"Configuration"),"!")),(0,o.kt)("h2",{id:"Testing-strategies"},"Testing strategies"),(0,o.kt)("p",null,"You're about to embark on writing tests for your application, and only ",(0,o.kt)("em",{parentName:"p"},"you"),"\nknow your application, so we don't have a lot of specific advice to give you."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"What to test, where the edge cases and seams are, what regressions you're\nlikely to run into, etc. are entirely up to you, your application, and your\nteam.")),(0,o.kt)("p",null,"That said, modern web testing has a few wrinkles that every team experiences, so\nhere are some quick tips on common situations you're likely to run into."),(0,o.kt)("h3",{id:"Seeding-data"},"Seeding data"),(0,o.kt)("p",null,"Depending on how your application is built - it's likely that your web\napplication is going to be affected and controlled by the server."),(0,o.kt)("p",null,"Typically these days servers communicate with front end apps via JSON, but you\ncould also be running a traditional server-side rendered HTML web application."),(0,o.kt)("p",null,"Generally the server is responsible for sending responses that reflect some kind\nof ",(0,o.kt)("strong",{parentName:"p"},"state")," it holds - generally in a database."),(0,o.kt)("p",null,"Traditionally when writing ",(0,o.kt)("inlineCode",{parentName:"p"},"e2e")," tests using Selenium, before you automate the\nbrowser you do some kind of ",(0,o.kt)("strong",{parentName:"p"},"set up and tear down")," on the server."),(0,o.kt)("p",null,"Perhaps you'll need to generate a user, and seed them with associations and\nrecords. You may be familiar with using things such as fixtures or factories."),(0,o.kt)("p",null,"To test various page states - like an empty view, or a pagination view, you'd\nneed to seed the server so that this state can be tested."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"While there is a lot more to this strategy, you generally have three ways to\nfacilitate this with Cypress:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/commands/exec"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.exec()"))," - to run system commands"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/commands/task"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.task()"))," - to run code in Node via the\n",(0,o.kt)("a",{parentName:"li",href:"/guides/tooling/plugins-guide#Using-a-plugin"},"setupNodeEvents")," function"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/commands/request"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.request()"))," - to make HTTP requests")),(0,o.kt)("p",null,"If you're running ",(0,o.kt)("inlineCode",{parentName:"p"},"node.js")," on your server, you might add a ",(0,o.kt)("inlineCode",{parentName:"p"},"before")," or\n",(0,o.kt)("inlineCode",{parentName:"p"},"beforeEach")," hook that executes an ",(0,o.kt)("inlineCode",{parentName:"p"},"npm")," task."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"describe('The Home Page', () => {\n  beforeEach(() => {\n    // reset and seed the database prior to every test\n    cy.exec('npm run db:reset && npm run db:seed')\n  })\n\n  it('successfully loads', () => {\n    cy.visit('/')\n  })\n})\n")),(0,o.kt)("p",null,"Instead of just executing a system command, you may want more flexibility and\ncould expose a series of routes only when running in a test environment."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For instance, you could compose several requests together to tell your server\nexactly the state you want to create.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"describe('The Home Page', () => {\n  beforeEach(() => {\n    // reset and seed the database prior to every test\n    cy.exec('npm run db:reset && npm run db:seed')\n\n    // seed a post in the DB that we control from our tests\n    cy.request('POST', '/test/seed/post', {\n      title: 'First Post',\n      authorId: 1,\n      body: '...',\n    })\n\n    // seed a user in the DB that we can control from our tests\n    cy.request('POST', '/test/seed/user', { name: 'Jane' })\n      .its('body')\n      .as('currentUser')\n  })\n\n  it('successfully loads', () => {\n    // this.currentUser will now point to the response\n    // body of the cy.request() that we could use\n    // to log in or work with in some way\n\n    cy.visit('/')\n  })\n})\n")),(0,o.kt)("p",null,"While there's nothing really ",(0,o.kt)("em",{parentName:"p"},"wrong")," with this approach, it does add a lot of\ncomplexity. You will be battling synchronizing the state between your server and\nyour browser - and you'll always need to set up / tear down this state before\ntests (which is slow)."),(0,o.kt)("p",null,"The good news is that we aren't Selenium, nor are we a traditional e2e testing\ntool. That means we're not bound to the same restrictions."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"With Cypress, there are several other approaches that can offer an arguably\nbetter and faster experience.")),(0,o.kt)("h3",{id:"Stubbing-the-server"},"Stubbing the server"),(0,o.kt)("p",null,"Another valid approach opposed to seeding and talking to your server is to\nbypass it altogether."),(0,o.kt)("p",null,"While you'll still receive all of the regular HTML / JS / CSS assets from your\nserver and you'll continue to ",(0,o.kt)("a",{parentName:"p",href:"/api/commands/visit"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.visit()"))," it in the same\nway - you can instead ",(0,o.kt)("strong",{parentName:"p"},"stub")," the JSON responses coming from it."),(0,o.kt)("p",null,"This means that instead of resetting the database, or seeding it with the state\nwe want, you can force the server to respond with ",(0,o.kt)("strong",{parentName:"p"},"whatever")," you want it to.\nIn this way, we not only prevent needing to synchronize the state between the\nserver and browser, but we also prevent mutating state from our tests. That\nmeans tests won't build up state that may affect other tests."),(0,o.kt)("p",null,"Another upside is that this enables you to ",(0,o.kt)("strong",{parentName:"p"},"build out your application"),"\nwithout needing the ",(0,o.kt)("em",{parentName:"p"},"contract")," of the server to exist. You can build it the way\nyou want the data to be structured, and even test all of the edge cases, without\nneeding a server."),(0,o.kt)("p",null,"However - there is likely still a balance here where ",(0,o.kt)("strong",{parentName:"p"},"both")," strategies are\nvalid (and you should likely do them)."),(0,o.kt)("p",null,"While stubbing is great, it means that you don't have the guarantees that these\nresponse payloads actually match what the server will send. However, there are\nstill many valid ways to get around this:"),(0,o.kt)("h4",{id:"Generate-the-fixture-stubs-ahead-of-time"},"Generate the fixture stubs ahead of time"),(0,o.kt)("p",null,"You could have the server generate all of the fixture stubs for you ahead of\ntime. This means their data will reflect what the server will actually send."),(0,o.kt)("h4",{id:"Write-a-single-e2e-test-without-stubs-and-then-stub-the-rest"},"Write a single e2e test without stubs, and then stub the rest"),(0,o.kt)("p",null,"Another more balanced approach is to integrate both strategies. You likely want\nto have a ",(0,o.kt)("strong",{parentName:"p"},"single test")," that takes a true ",(0,o.kt)("inlineCode",{parentName:"p"},"e2e")," approach and stubs nothing.\nIt'll use the feature for real - including seeding the database and setting up\nstate."),(0,o.kt)("p",null,"Once you've established it's working you can then use stubs to test all of the\nedge cases and additional scenarios. There are no benefits to using real data in\nthe vast majority of cases. We recommend that the vast majority of tests use\nstub data. They will be orders of magnitude faster, and much less complex."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("strong",null,"Guide: Network Requests"),(0,o.kt)("p",{parentName:"admonition"},"Please read our ",(0,o.kt)("a",{parentName:"p",href:"/guides/guides/network-requests"},"Guide on Network Requests")," for\na much more thorough analysis and approach to accomplishing this.")),(0,o.kt)("h3",{id:"Logging-in"},"Logging in"),(0,o.kt)("p",null,"One of the first (and arguably one of the hardest) hurdles you'll have to\novercome in testing is logging into your application."),(0,o.kt)("p",null,"Nothing slows a test suite down like having to log in, but all the good parts of\nyour application most likely require an authenticated user! Here are some tips."),(0,o.kt)("h4",{id:"Fully-test-the-login-flow----but-only-once"},"Fully test the login flow -- but only once!"),(0,o.kt)("p",null,"It's a great idea to get your signup and login flow under test coverage since it\nis very important to all of your users and you never want it to break."),(0,o.kt)("p",null,"Logging in is one of those features that are ",(0,o.kt)("strong",{parentName:"p"},"mission critical")," and should\nlikely involve your server. We recommend you test signup and login using your UI\nas a real user would:"),(0,o.kt)("p",null,"Here's an example alongside seeding your database:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"describe('The Login Page', () => {\n  beforeEach(() => {\n    // reset and seed the database prior to every test\n    cy.exec('npm run db:reset && npm run db:seed')\n\n    // seed a user in the DB that we can control from our tests\n    // assuming it generates a random password for us\n    cy.request('POST', '/test/seed/user', { username: 'jane.lane' })\n      .its('body')\n      .as('currentUser')\n  })\n\n  it('sets auth cookie when logging in via form submission', function () {\n    // destructuring assignment of the this.currentUser object\n    const { username, password } = this.currentUser\n\n    cy.visit('/login')\n\n    cy.get('input[name=username]').type(username)\n\n    // {enter} causes the form to submit\n    cy.get('input[name=password]').type(`${password}{enter}`)\n\n    // we should be redirected to /dashboard\n    cy.url().should('include', '/dashboard')\n\n    // our auth cookie should be present\n    cy.getCookie('your-session-cookie').should('exist')\n\n    // UI should reflect this user being logged in\n    cy.get('h1').should('contain', 'jane.lane')\n  })\n})\n")),(0,o.kt)("p",null,"You'll likely also want to test your login UI for:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Invalid username / password"),(0,o.kt)("li",{parentName:"ul"},"Username taken"),(0,o.kt)("li",{parentName:"ul"},"Password complexity requirements"),(0,o.kt)("li",{parentName:"ul"},"Edge cases like locked / deleted accounts")),(0,o.kt)("p",null,"Each of these likely requires a full blown e2e test."),(0,o.kt)("h4",{id:"Reusing-the-login-code"},"Reusing the login code"),(0,o.kt)("p",null,"At this point there's nothing stopping you copying and pasting the login code\nabove into every one of your tests that needs an authenticated user. Or you\ncould even put all your tests in one big spec file and put the login code in a\n",(0,o.kt)("inlineCode",{parentName:"p"},"beforeEach")," block. But neither of those approaches is particularly\nmaintainable, and they're certainly not very elegant. A much better solution is\nto write a custom ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.login()")," ",(0,o.kt)("a",{parentName:"p",href:"/api/cypress-api/custom-commands"},"command"),"."),(0,o.kt)("p",null,"Custom commands allow you to easily encapsulate and reuse Cypress test logic.\nThey let you add your own functionality to your test suite and then use it with\nthe same\n",(0,o.kt)("a",{parentName:"p",href:"/guides/core-concepts/introduction-to-cypress#The-Cypress-Command-Queue"},"chainable and asynchronous API"),"\nas the built-in Cypress commands. Lets make the above login example a custom\ncommand and add it to ",(0,o.kt)("inlineCode",{parentName:"p"},"cypress/support/commands.js")," so it can be leveraged in\nany spec file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// In cypress/support/commands.js\n\nCypress.Commands.add('login', (username, password) => {\n  cy.visit('/login')\n\n  cy.get('input[name=username]').type(username)\n\n  // {enter} causes the form to submit\n  cy.get('input[name=password]').type(`${password}{enter}`, { log: false })\n\n  // we should be redirected to /dashboard\n  cy.url().should('include', '/dashboard')\n\n  // our auth cookie should be present\n  cy.getCookie('your-session-cookie').should('exist')\n\n  // UI should reflect this user being logged in\n  cy.get('h1').should('contain', username)\n})\n\n// In your spec file\n\nit('does something on a secured page', function () {\n  const { username, password } = this.currentUser\n  cy.login(username, password)\n\n  // ...rest of test\n})\n")),(0,o.kt)("h4",{id:"Improving-performance"},"Improving performance"),(0,o.kt)("p",null,'You\'re probably wondering what happened to our advice about logging in "only\nonce". The custom command above will work just fine for testing your secured\npages, but if you have more than a handful of tests, logging in before every\ntest is going to increase the overall run time of your suite.'),(0,o.kt)("p",null,"Luckily, Cypress provides the ",(0,o.kt)("a",{parentName:"p",href:"/api/commands/session"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.session()"))," command, a\npowerful performance tool that lets you cache the browser context associated\nwith your user and reuse it for multiple tests without going through multiple\nlogin flows! Let's modify the custom ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.login()")," command from our previous\nexample to use ",(0,o.kt)("inlineCode",{parentName:"p"},"cy.session()"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Cypress.Commands.add('login', (username, password) => {\n  cy.session(\n    username,\n    () => {\n      cy.visit('/login')\n      cy.get('input[name=username]').type(username)\n      cy.get('input[name=password]').type(`${password}{enter}`, { log: false })\n      cy.url().should('include', '/dashboard')\n      cy.get('h1').should('contain', username)\n    },\n    {\n      validate: () => {\n        cy.getCookie('your-session-cookie').should('exist')\n      },\n    }\n  )\n})\n")),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("strong",null,"Third-Party Login"),(0,o.kt)("p",{parentName:"admonition"},"If your app implements login via a third-party authentication provider such as\n",(0,o.kt)("a",{parentName:"p",href:"https://auth0.com/"},"Auth0")," or ",(0,o.kt)("a",{parentName:"p",href:"https://www.okta.com/"},"Okta"),", you can use the\n",(0,o.kt)("a",{parentName:"p",href:"/api/commands/origin"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.origin()"))," command to include their login pages as\npart of your authentication tests.")),(0,o.kt)("p",null,"There's a lot going on here that's out of the scope for this introduction.\nPlease check out the ",(0,o.kt)("a",{parentName:"p",href:"/api/commands/session"},(0,o.kt)("inlineCode",{parentName:"a"},"cy.session()"))," documentation for a\nmore in-depth explanation."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("strong",null,"Authentication Recipes"),(0,o.kt)("p",{parentName:"admonition"},"Logging in can be more complex than what we've just covered."),(0,o.kt)("p",{parentName:"admonition"},"We've created several recipes covering additional scenarios like dealing with\nCSRF tokens or testing XHR based login forms."),(0,o.kt)("p",{parentName:"admonition"},"Feel free to ",(0,o.kt)("a",{parentName:"p",href:"/examples/recipes"},"explore these additional logging in")," recipes.")),(0,o.kt)("h2",{id:"Get-started"},"Get started"),(0,o.kt)("p",null,"Ok, we're done talking. Now dive in and get started testing your app!"),(0,o.kt)("p",null,"From here you may want to explore some more of our guides:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/examples/tutorials"},"Tutorial Videos")," to watch step-by-step tutorial videos"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/api/table-of-contents"},"Cypress API")," to learn what commands are available as\nyou work"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/guides/core-concepts/introduction-to-cypress"},"Introduction to Cypress"),"\nexplains how Cypress ",(0,o.kt)("em",{parentName:"li"},"really")," works"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/guides/guides/command-line"},"Command Line")," for running all your tests outside\nvia ",(0,o.kt)("inlineCode",{parentName:"li"},"cypress run")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/guides/continuous-integration/introduction"},"Continuous Integration")," for\nrunning Cypress in CI"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"/guides/guides/cross-browser-testing"},"Cross Browser Testing")," for optimally\nrunning tests in CI across Firefox and Chrome-family browsers"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)(d,{name:"github",inline:"true",contentType:"rwa",mdxType:"Icon"})," demonstrations of Cypress testing practices, configuration, and strategies in a real-world project.")))}y.isMDXComponent=!0}}]);