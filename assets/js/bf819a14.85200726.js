"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[4470],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=u(n),p=r,h=m["".concat(s,".").concat(p)]||m[p]||c[p]||i;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,l=new Array(i);l[0]=p;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[m]="string"==typeof e?e:r,l[1]=o;for(var u=2;u<i;u++)l[u]=n[u];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},8448:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const i={title:"then"},l=void 0,o={unversionedId:"api/commands/then",id:"api/commands/then",title:"then",description:"Enables you to work with the subject yielded from the previous command.",source:"@site/docs/api/commands/then.mdx",sourceDirName:"api/commands",slug:"/api/commands/then",permalink:"/cypress-documentation/api/commands/then",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/api/commands/then.mdx",tags:[],version:"current",lastUpdatedAt:1698909506,formattedLastUpdatedAt:"Nov 2, 2023",frontMatter:{title:"then"},sidebar:"api",previous:{title:"task",permalink:"/cypress-documentation/api/commands/task"},next:{title:"tick",permalink:"/cypress-documentation/api/commands/tick"}},s={},u=[{value:"Syntax",id:"Syntax",level:2},{value:"Usage",id:"Usage",level:3},{value:"Arguments",id:"Arguments",level:3},{value:'Yields <Icon name="question-circle"/>',id:"Yields",level:3},{value:"Examples",id:"Examples",level:2},{value:"DOM element",id:"DOM-element",level:3},{value:"The <code>button</code> element is yielded",id:"The-button-element-is-yielded",level:4},{value:"The number is yielded from previous command",id:"The-number-is-yielded-from-previous-command",level:4},{value:"Change subject",id:"Change-subject",level:3},{value:"The el subject is changed with another command",id:"The-el-subject-is-changed-with-another-command",level:4},{value:"The number subject is changed with another command",id:"The-number-subject-is-changed-with-another-command",level:4},{value:"The number subject is changed by returning",id:"The-number-subject-is-changed-by-returning",level:4},{value:"Returning <code>undefined</code> will not modify the yielded subject",id:"Returning-undefined-will-not-modify-the-yielded-subject",level:4},{value:"Raw HTMLElements are wrapped with jQuery",id:"Raw-HTMLElements-are-wrapped-with-jQuery",level:3},{value:"Promises",id:"Promises",level:3},{value:"Example using Q",id:"Example-using-Q",level:4},{value:"Example using bluebird",id:"Example-using-bluebird",level:4},{value:"Example using jQuery deferred&#39;s",id:"Example-using-jQuery-deferreds",level:4},{value:"Notes",id:"Notes",level:2},{value:"Differences",id:"Differences",level:3},{value:"Rules",id:"Rules",level:2},{value:'Requirements <Icon name="question-circle"/>',id:"Requirements",level:3},{value:'Assertions <Icon name="question-circle"/>',id:"Assertions",level:3},{value:'Timeouts <Icon name="question-circle"/>',id:"Timeouts",level:3},{value:"Command Log",id:"Command-Log",level:2},{value:"History",id:"History",level:2},{value:"See also",id:"See-also",level:2}],d=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},m=d("Icon"),c=d("ThenShouldAndDifference"),p={toc:u};function h(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Enables you to work with the subject yielded from the previous command."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Note:")," ",(0,r.kt)("inlineCode",{parentName:"p"},".then()")," assumes you are already familiar with core concepts such as\n",(0,r.kt)("a",{parentName:"p",href:"/guides/core-concepts/variables-and-aliases#Closures"},"closures"),".")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Note:")," Prefer ",(0,r.kt)("a",{parentName:"p",href:"/api/commands/should#Function"},(0,r.kt)("inlineCode",{parentName:"a"},".should()")," with callback")," over\n",(0,r.kt)("inlineCode",{parentName:"p"},".then()")," for assertions as they are automatically rerun until no assertions\nthrow within it but be aware of ",(0,r.kt)("a",{parentName:"p",href:"/api/commands/should#Differences"},"differences"),".")),(0,r.kt)("h2",{id:"Syntax"},"Syntax"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},".then(callbackFn)\n.then(options, callbackFn)\n")),(0,r.kt)("h3",{id:"Usage"},"Usage"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)(m,{name:"check-circle",color:"green",mdxType:"Icon"})," Correct Usage")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('.nav').then(($nav) => {}) // Yields .nav as first arg\ncy.location().then((loc) => {}) // Yields location object as first arg\n")),(0,r.kt)("h3",{id:"Arguments"},"Arguments"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)(m,{name:"angle-right",mdxType:"Icon"})," options")," ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"(Object)"))),(0,r.kt)("p",null,"Pass in an options object to change the default behavior of ",(0,r.kt)("inlineCode",{parentName:"p"},".then()"),"."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Option"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"timeout")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/guides/references/configuration#Timeouts"},(0,r.kt)("inlineCode",{parentName:"a"},"defaultCommandTimeout"))),(0,r.kt)("td",{parentName:"tr",align:null},"Time to wait for ",(0,r.kt)("inlineCode",{parentName:"td"},".then()")," to resolve before ",(0,r.kt)("a",{parentName:"td",href:"#Timeouts"},"timing out"))))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},(0,r.kt)(m,{name:"angle-right",mdxType:"Icon"})," callbackFn")," ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},"(Function)"))),(0,r.kt)("p",null,"Pass a function that takes the previously yielded subject as its first argument."),(0,r.kt)("h3",{id:"Yields"},"Yields ",(0,r.kt)("a",{parentName:"h3",href:"/guides/core-concepts/introduction-to-cypress#Subject-Management"},(0,r.kt)(m,{name:"question-circle",mdxType:"Icon"}))),(0,r.kt)("p",null,"Whatever is returned from the callback function becomes the new subject and will\nflow into the next command (with the exception of ",(0,r.kt)("inlineCode",{parentName:"p"},"undefined")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"null"),")."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"If the return value is a chain of Cypress commands (eg\n",(0,r.kt)("inlineCode",{parentName:"li"},"return cy.get('button')"),"), Cypress will wait for them to resolve and use\ntheir return value as the new subject."),(0,r.kt)("li",{parentName:"ul"},"If the return value is a Promise, Cypress will wait for it to resolve, and use\nthe resolved value as the new subject to continue the chain of commands."),(0,r.kt)("li",{parentName:"ul"},"If the callback returns ",(0,r.kt)("inlineCode",{parentName:"li"},"undefined")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"null")," (or there is no return value),\nthe result of the last Cypress command in the callback function will be\nyielded as the new subject instead, and flow into the next command."),(0,r.kt)("li",{parentName:"ul"},"If the callback returns ",(0,r.kt)("inlineCode",{parentName:"li"},"undefined")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"null")," (or there is no return value)\nand the callback does not call any Cypress commands, the subject will not be\nmodified, and the previous subject will carry over to the next command.")),(0,r.kt)("p",null,"The callback function of ",(0,r.kt)("inlineCode",{parentName:"p"},".then()")," is not retried. It is\n",(0,r.kt)("a",{parentName:"p",href:"/guides/core-concepts/retry-ability#Only-queries-are-retried"},"unsafe")," to return\nDOM elements directly from the callback and then use further commands on them.\nInstead, use Cypress queries to locate the elements you're interested in acting\nor asserting on."),(0,r.kt)("h2",{id:"Examples"},"Examples"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"We have several more examples in our\n",(0,r.kt)("a",{parentName:"p",href:"/guides/core-concepts/variables-and-aliases"},"Core Concepts Guide")," which go into\nthe various ways you can use ",(0,r.kt)("inlineCode",{parentName:"p"},".then()")," to store, compare, and debug values.")),(0,r.kt)("h3",{id:"DOM-element"},"DOM element"),(0,r.kt)("h4",{id:"The-button-element-is-yielded"},"The ",(0,r.kt)("inlineCode",{parentName:"h4"},"button")," element is yielded"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('button').then(($btn) => {\n  const cls = $btn.attr('class')\n\n  cy.wrap($btn).click().should('not.have.class', cls)\n})\n")),(0,r.kt)("h4",{id:"The-number-is-yielded-from-previous-command"},"The number is yielded from previous command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"cy.wrap(1)\n  .then((num) => {\n    cy.wrap(num).should('equal', 1) // true\n  })\n  .should('equal', 1) // true\n")),(0,r.kt)("h3",{id:"Change-subject"},"Change subject"),(0,r.kt)("h4",{id:"The-el-subject-is-changed-with-another-command"},"The el subject is changed with another command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('button')\n  .then(($btn) => {\n    const cls = $btn.attr('class')\n\n    cy.wrap($btn).click().should('not.have.class', cls).find('i')\n    // since there is no explicit return\n    // the last Cypress command's yield is yielded\n  })\n  .should('have.class', 'spin') // assert on i element\n")),(0,r.kt)("h4",{id:"The-number-subject-is-changed-with-another-command"},"The number subject is changed with another command"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.wrap(1).then((num) => {\n  cy.wrap(num)).should('equal', 1) // true\n  cy.wrap(2)\n}).should('equal', 2) // true\n")),(0,r.kt)("h4",{id:"The-number-subject-is-changed-by-returning"},"The number subject is changed by returning"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.wrap(1)\n  .then((num) => {\n    cy.wrap(num).should('equal', 1) // true\n\n    return 2\n  })\n  .should('equal', 2) // true\n")),(0,r.kt)("h4",{id:"Returning-undefined-will-not-modify-the-yielded-subject"},"Returning ",(0,r.kt)("inlineCode",{parentName:"h4"},"undefined")," will not modify the yielded subject"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('form')\n  .then(($form) => {\n    console.log('form is:', $form)\n    // undefined is returned here, but $form will be\n    // yielded to allow for continued chaining\n  })\n  .find('input')\n  .then(($input) => {\n    // we have our $input element here since\n    // our form element was yielded and we called\n    // .find('input') on it\n  })\n")),(0,r.kt)("h3",{id:"Raw-HTMLElements-are-wrapped-with-jQuery"},"Raw HTMLElements are wrapped with jQuery"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('div')\n  .then(($div) => {\n    return $div[0] // type => HTMLDivElement\n  })\n  .then(($div) => {\n    $div // type => JQuery<HTMLDivElement>\n  })\n")),(0,r.kt)("h3",{id:"Promises"},"Promises"),(0,r.kt)("p",null,"Cypress waits for Promises to resolve before continuing"),(0,r.kt)("h4",{id:"Example-using-Q"},"Example using Q"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('button')\n  .click()\n  .then(($button) => {\n    const p = Q.defer()\n\n    setTimeout(() => {\n      p.resolve()\n    }, 1000)\n\n    return p.promise\n  })\n")),(0,r.kt)("h4",{id:"Example-using-bluebird"},"Example using bluebird"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('button')\n  .click()\n  .then(($button) => {\n    return Promise.delay(1000)\n  })\n")),(0,r.kt)("h4",{id:"Example-using-jQuery-deferreds"},"Example using jQuery deferred's"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('button')\n  .click()\n  .then(($button) => {\n    const df = $.Deferred()\n\n    setTimeout(() => {\n      df.resolve()\n    }, 1000)\n\n    return df\n  })\n")),(0,r.kt)("h2",{id:"Notes"},"Notes"),(0,r.kt)("h3",{id:"Differences"},"Differences"),(0,r.kt)(c,{mdxType:"ThenShouldAndDifference"}),(0,r.kt)("h2",{id:"Rules"},"Rules"),(0,r.kt)("h3",{id:"Requirements"},"Requirements ",(0,r.kt)("a",{parentName:"h3",href:"/guides/core-concepts/introduction-to-cypress#Chains-of-Commands"},(0,r.kt)(m,{name:"question-circle",mdxType:"Icon"}))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},".then()")," requires being chained off a previous command.")),(0,r.kt)("h3",{id:"Assertions"},"Assertions ",(0,r.kt)("a",{parentName:"h3",href:"/guides/core-concepts/introduction-to-cypress#Assertions"},(0,r.kt)(m,{name:"question-circle",mdxType:"Icon"}))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},".then()")," will only run assertions you have chained once, and will not\n",(0,r.kt)("a",{parentName:"li",href:"/guides/core-concepts/retry-ability"},"retry"),".")),(0,r.kt)("h3",{id:"Timeouts"},"Timeouts ",(0,r.kt)("a",{parentName:"h3",href:"/guides/core-concepts/introduction-to-cypress#Timeouts"},(0,r.kt)(m,{name:"question-circle",mdxType:"Icon"}))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},".then()")," can time out waiting for a promise you've returned to resolve.")),(0,r.kt)("h2",{id:"Command-Log"},"Command Log"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},".then()")," does ",(0,r.kt)("em",{parentName:"li"},"not")," log in the Command Log")),(0,r.kt)("h2",{id:"History"},"History"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Version"),(0,r.kt)("th",{parentName:"tr",align:null},"Changes"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/guides/references/changelog#0-14-0"},"0.14.0")),(0,r.kt)("td",{parentName:"tr",align:null},"Added ",(0,r.kt)("inlineCode",{parentName:"td"},"timeout")," option")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"/guides/references/changelog#0-3-3"},"< 0.3.3")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},".then()")," command added")))),(0,r.kt)("h2",{id:"See-also"},"See also"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/commands/and"},(0,r.kt)("inlineCode",{parentName:"a"},".and()"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/commands/each"},(0,r.kt)("inlineCode",{parentName:"a"},".each()"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/commands/invoke"},(0,r.kt)("inlineCode",{parentName:"a"},".invoke()"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/commands/its"},(0,r.kt)("inlineCode",{parentName:"a"},".its()"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/commands/should"},(0,r.kt)("inlineCode",{parentName:"a"},".should()"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/api/commands/spread"},(0,r.kt)("inlineCode",{parentName:"a"},".spread()"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/guides/core-concepts/variables-and-aliases#Closures"},"Guide: Using Closures to compare values")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/guides/core-concepts/introduction-to-cypress#Chains-of-Commands"},"Guide: Chains of Commands"))))}h.isMDXComponent=!0}}]);