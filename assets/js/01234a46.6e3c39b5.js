"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[4806],{3905:(e,n,t)=>{t.d(n,{Zo:()=>l,kt:()=>f});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function a(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},s=Object.keys(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)t=s[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=o.createContext({}),c=function(e){var n=o.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=c(e.components);return o.createElement(p.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,l=a(e,["components","mdxType","originalType","parentName"]),u=c(t),m=r,f=u["".concat(p,".").concat(m)]||u[m]||d[m]||s;return t?o.createElement(f,i(i({ref:n},l),{},{components:t})):o.createElement(f,i({ref:n},l))}));function f(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,i=new Array(s);i[0]=m;var a={};for(var p in n)hasOwnProperty.call(n,p)&&(a[p]=n[p]);a.originalType=e,a[u]="string"==typeof e?e:r,i[1]=a;for(var c=2;c<s;c++)i[c]=t[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}m.displayName="MDXCreateElement"},3747:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>p,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>a,toc:()=>c});var o=t(7462),r=(t(7294),t(3905));const s={title:"Component Testing Config",sidebar_position:30,sidebar_label:"Configuration"},i=void 0,a={unversionedId:"guides/component-testing/component-framework-configuration",id:"guides/component-testing/component-framework-configuration",title:"Component Testing Config",description:"When you launch Cypress for the first time in a project, the app will",source:"@site/docs/guides/component-testing/component-framework-configuration.mdx",sourceDirName:"guides/component-testing",slug:"/guides/component-testing/component-framework-configuration",permalink:"/cypress-documentation/guides/component-testing/component-framework-configuration",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/component-testing/component-framework-configuration.mdx",tags:[],version:"current",sidebarPosition:30,frontMatter:{title:"Component Testing Config",sidebar_position:30,sidebar_label:"Configuration"},sidebar:"guides",previous:{title:"Styling Components",permalink:"/cypress-documentation/guides/component-testing/styling-components"},next:{title:"FAQ",permalink:"/cypress-documentation/guides/component-testing/faq"}},p={},c=[{value:"Custom Index File",id:"Custom-Index-File",level:2},{value:"Custom Dev Server",id:"Custom-Dev-Server",level:2},{value:"Spec Pattern for Component Tests",id:"Spec-Pattern-for-Component-Tests",level:2},{value:"Additional Config",id:"Additional-Config",level:2}],l=(u="CypressConfigFileTabs",function(e){return console.warn("Component "+u+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var u;const d={toc:c};function m(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,o.Z)({},d,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"When you launch Cypress for the first time in a project, the app will\nautomatically guide you through setup and configuration. You don't need to do\nanything additional to get started."),(0,r.kt)("p",null,'Refer to the "Framework Configuration" guide in each UI framework\'s overview\nguide for a list of supported development servers and how they are configured.'),(0,r.kt)("p",null,"Below are more advanced configuration options you can customize to fit your\nproject."),(0,r.kt)("h2",{id:"Custom-Index-File"},"Custom Index File"),(0,r.kt)("p",null,"By default, Cypress renders your components into an HTML file located at\n",(0,r.kt)("inlineCode",{parentName:"p"},"cypress/support/component-index.html"),"."),(0,r.kt)("p",null,"The index file allows you to add in global assets, such as styles, fonts, and\nexternal scripts."),(0,r.kt)("p",null,"You can provide an alternative path to the file using the ",(0,r.kt)("inlineCode",{parentName:"p"},"indexHtmlFile")," option\nin the ",(0,r.kt)("a",{parentName:"p",href:"/guides/references/configuration#component"},"component config")," options:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n  component: {\n    devServer,\n    indexHtmlFile: '/custom/path/to/component-index.html'\n  }\n}\n")),(0,r.kt)("h2",{id:"Custom-Dev-Server"},"Custom Dev Server"),(0,r.kt)("p",null,"A custom function can be passed into the ",(0,r.kt)("inlineCode",{parentName:"p"},"devServer")," option, which allows the\nuse of build systems not provided by Cypress out of the box. These can be from\nthe Cypress community, preview builds not included with the app, or a custom one\nyou create."),(0,r.kt)("p",null,"The function's signature takes in an object with the following properties as its\nonly parameter and needs to resolve an object containing the port of your dev\nserver and a callback to shut it down."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"interface DevServerOptions {\n  specs: Cypress.Spec[]\n  cypressConfig: Cypress.PluginConfigOptions\n  devServerEvents: NodeJS.EventEmitter\n}\n")),(0,r.kt)("cypress-config-example",null,(0,r.kt)(l,{mdxType:"CypressConfigFileTabs"},(0,r.kt)("pre",{parentName:"cypress-config-example"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { defineConfig } = require('cypress')\n\nmodule.exports = defineConfig({\n  component: {\n    async devServer({ specs, cypressConfig, devServerEvents }) {\n      const { port, close } = await startDevServer(\n        specs,\n        cypressConfig,\n        devServerEvents\n      )\n\n      return {\n        port,\n        close,\n      }\n    },\n  },\n})\n")),(0,r.kt)("pre",{parentName:"cypress-config-example"},(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"import { defineConfig } from 'cypress'\n\nexport default defineConfig({\n  component: {\n    async devServer({\n      specs,\n      cypressConfig,\n      devServerEvents,\n    }: DevServerOptions) {\n      const { port, close } = await startDevServer(\n        specs,\n        cypressConfig,\n        devServerEvents\n      )\n\n      return {\n        port,\n        close,\n      }\n    },\n  },\n})\n")))),(0,r.kt)("p",null,"Any requests triggered during a test using the ",(0,r.kt)("inlineCode",{parentName:"p"},"devServerPublicPathRoute")," as\ndefined in the ",(0,r.kt)("inlineCode",{parentName:"p"},"cypressConfig")," will be forwarded to your server. Cypress will\ntrigger a request for ",(0,r.kt)("inlineCode",{parentName:"p"},"[devServerPublicPathRoute]/index.html")," when a test is\nstarted. Your server needs to reply with the html-file referenced in\n",(0,r.kt)("inlineCode",{parentName:"p"},"cypressConfig.indexHtmlFile")," and inject a script to load the support files and\nthe actual test."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"function createServer(cypressConfig, bundleDir, port = 1234) {\n  const app = express()\n\n  // read kickstart script - see below for an example\n  const clientScript = readFileSync(\n    path.join(__dirname, './client-script.js'),\n    'utf8'\n  )\n\n  app.get(\n    cypressConfig.devServerPublicPathRoute + '/index.html',\n    async (_req, res) => {\n      // read custom index.html file\n      const html = await fs.readFile(\n        path.join(cypressConfig.repoRoot, cypressConfig.indexHtmlFile),\n        { encoding: 'utf8' }\n      )\n\n      // inject kickstart-script\n      const output = html.replace(\n        '</head>',\n        `<script type=\"module\">${clientScript}<\/script></head>`\n      )\n      res.send(output)\n    }\n  )\n\n  // you need to establish some url-to-path-mapping, if your bundler outputs\n  // the full directory structure you can map this one to one\n  app.use(cypressConfig.devServerPublicPathRoute, express.static(bundleDir))\n\n  app.listen(port)\n}\n")),(0,r.kt)("p",null,"For a real-world example, you can refer to\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress/blob/466155c2125476374d9f9549530f67d0c6354a41/npm/vite-dev-server/src/plugins/cypress.ts#L82-L92"},"this loader"),"\nused by the Vite Dev Server."),(0,r.kt)("p",null,"The client script must retrieve information on the currently active test from\nthe Cypress instance of the parent frame and load the corresponding bundle. If a\nsupport file is defined, it should be injected at the top of your test bundle or\nloaded before the test script."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"const CypressInstance = (window.Cypress = parent.Cypress)\nconst devServerPublicPathRoute = CypressInstance.config(\n  'devServerPublicPathRoute'\n)\n\nlet importPromise = Promise.resolve()\n\n// If you do not bundle your support file along with the tests,\n// you need to add a separate import statement for the support file.\nconst supportFilePath = CypressInstance.config('supportFile')\nif (supportFilePath) {\n  const relative = supportFilePath.replace(\n    CypressInstance.config('projectRoot'),\n    ''\n  )\n  importPromise = importPromise.then(\n    () => import(`${devServerPublicPathRoute}${relative}`)\n  )\n}\n\n// load the spec - you can extend the load function to also load css\nconst { relative } = CypressInstance.spec\nimportPromise = importPromise.then(\n  () => import(`${devServerPublicPathRoute}/${relative}`)\n)\n\n// trigger loading the imports\nCypressInstance.onSpecWindow(window, importPromise)\n\n// then start the test process\nCypressInstance.action('app:window:before:load', window)\n")),(0,r.kt)("p",null,"For a more complete example you can check out the\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress/blob/develop/npm/vite-dev-server/client/initCypressTests.js"},"kickstart script used in the vite-devserver.")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"devServerEvents")," event emitter should be used to notify cypress about\nfinished builds by emitting a ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-server:compile:success")," event and to listen\nfor the ",(0,r.kt)("inlineCode",{parentName:"p"},"dev-server:specs:changed")," event that will notify you about changed\nentry points."),(0,r.kt)("h2",{id:"Spec-Pattern-for-Component-Tests"},"Spec Pattern for Component Tests"),(0,r.kt)("p",null,"By default, Cypress looks for spec files anywhere in your project with an\nextension of ",(0,r.kt)("inlineCode",{parentName:"p"},".cy.js"),", ",(0,r.kt)("inlineCode",{parentName:"p"},".cy.jsx"),", ",(0,r.kt)("inlineCode",{parentName:"p"},".cy.ts"),", or ",(0,r.kt)("inlineCode",{parentName:"p"},".cy.tsx"),". However, you can\nchange this behavior for component tests with a custom ",(0,r.kt)("inlineCode",{parentName:"p"},"specPattern")," value. In\nthe following example, we've configured Cypress to look for spec files with\nthose same extensions, but only in the ",(0,r.kt)("inlineCode",{parentName:"p"},"src")," folder or any of its\nsubdirectories."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n  component: {\n    specPattern: 'src/**/*.cy.{js,jsx,ts,tsx}'\n  }\n}\n")),(0,r.kt)("h2",{id:"Additional-Config"},"Additional Config"),(0,r.kt)("p",null,"For more information on all the available configuration options, see the\n",(0,r.kt)("a",{parentName:"p",href:"/guides/references/configuration"},"configuration reference"),"."))}m.isMDXComponent=!0}}]);