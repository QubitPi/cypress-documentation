"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[6182],{3905:(e,n,t)=>{t.d(n,{Zo:()=>c,kt:()=>h});var i=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,i)}return t}function s(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,i,r=function(e,n){if(null==e)return{};var t,i,r={},a=Object.keys(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)t=a[i],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var l=i.createContext({}),p=function(e){var n=i.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):s(s({},n),e)),t},c=function(e){var n=p(e.components);return i.createElement(l.Provider,{value:n},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return i.createElement(i.Fragment,{},n)}},m=i.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(t),m=r,h=u["".concat(l,".").concat(m)]||u[m]||d[m]||a;return t?i.createElement(h,s(s({ref:n},c),{},{components:t})):i.createElement(h,s({ref:n},c))}));function h(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,s=new Array(a);s[0]=m;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[u]="string"==typeof e?e:r,s[1]=o;for(var p=2;p<a;p++)s[p]=t[p];return i.createElement.apply(null,s)}return i.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6895:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>p});var i=t(7462),r=(t(7294),t(3905));const a={title:"Bitbucket Pipelines"},s=void 0,o={unversionedId:"guides/continuous-integration/bitbucket-pipelines",id:"guides/continuous-integration/bitbucket-pipelines",title:"Bitbucket Pipelines",description:"What you'll learn",source:"@site/docs/guides/continuous-integration/bitbucket-pipelines.mdx",sourceDirName:"guides/continuous-integration",slug:"/guides/continuous-integration/bitbucket-pipelines",permalink:"/cypress-documentation/guides/continuous-integration/bitbucket-pipelines",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/continuous-integration/bitbucket-pipelines.mdx",tags:[],version:"current",lastUpdatedAt:1697463939,formattedLastUpdatedAt:"Oct 16, 2023",frontMatter:{title:"Bitbucket Pipelines"},sidebar:"guides",previous:{title:"AWS CodeBuild",permalink:"/cypress-documentation/guides/continuous-integration/aws-codebuild"},next:{title:"CircleCI",permalink:"/cypress-documentation/guides/continuous-integration/circleci"}},l={},p=[{value:"Basic Setup",id:"Basic-Setup",level:2},{value:"Testing in Chrome and Firefox with Cypress Docker Images",id:"Testing-in-Chrome-and-Firefox-with-Cypress-Docker-Images",level:2},{value:"Caching Dependencies and Build Artifacts",id:"Caching-Dependencies-and-Build-Artifacts",level:2},{value:"Parallelization",id:"Parallelization",level:2},{value:"Install Job",id:"Install-Job",level:3},{value:"Worker Jobs",id:"Worker-Jobs",level:3},{value:"Using Cypress Cloud with Bitbucket Pipelines",id:"Using-Cypress-Cloud-with-Bitbucket-Pipelines",level:2}],c=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",n)},u=c("Icon"),d=c("CiProviderCloudSteps"),m={toc:p};function h(e){let{components:n,...t}=e;return(0,r.kt)("wrapper",(0,i.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("h2",{parentName:"admonition",id:"What-youll-learn"},(0,r.kt)(u,{name:"graduation-cap",mdxType:"Icon"})," What you'll learn"),(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"How to run Cypress tests with Bitbucket Pipelines as part of CI/CD pipeline"),(0,r.kt)("li",{parentName:"ul"},"How to parallelize Cypress test runs withins Bitbucket Pipelines"))),(0,r.kt)("p",null,"With its integrated\n",(0,r.kt)("a",{parentName:"p",href:"https://bitbucket.org/product/features/pipelines"},"integrated CI/CD, Pipelines"),",\n",(0,r.kt)("a",{parentName:"p",href:"https://bitbucket.com"},"Bitbucket"),' offers developers "CI/CD where it belongs,\nright next to your code. No servers to manage, repositories to synchronize, or\nuser management to configure."'),(0,r.kt)("p",null,"Detailed documentation is available in the\n",(0,r.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/get-started-with-bitbucket-pipelines/"},"Bitbucket Pipelines Documentation"),"."),(0,r.kt)("h2",{id:"Basic-Setup"},"Basic Setup"),(0,r.kt)("p",null,"The example below shows a basic setup and job to use\n",(0,r.kt)("a",{parentName:"p",href:"https://bitbucket.org/product/features/pipelines"},"Bitbucket Pipelines")," to run\nend-to-end tests with Cypress and Electron."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"image: node:latest\n\npipelines:\n  default:\n    - step:\n        script:\n          # install dependencies\n          - npm ci\n          # start the server in the background\n          - npm run start &\n          # run Cypress tests\n          - npm run e2e\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"How this ",(0,r.kt)("inlineCode",{parentName:"strong"},"bitbucket-pipelines.yml")," works:")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On ",(0,r.kt)("em",{parentName:"li"},"push")," to this repository, this job will provision and start Bitbucket\nPipelines-hosted Linux instance for running the pipelines defined in the\n",(0,r.kt)("inlineCode",{parentName:"li"},"pipelines")," section of the configuration."),(0,r.kt)("li",{parentName:"ul"},"The code is checked out from our GitHub/Bitbucket repository."),(0,r.kt)("li",{parentName:"ul"},"Finally, our scripts will:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Install npm dependencies"),(0,r.kt)("li",{parentName:"ul"},"Start the project web server (",(0,r.kt)("inlineCode",{parentName:"li"},"npm start"),")"),(0,r.kt)("li",{parentName:"ul"},"Run the Cypress tests within our GitHub/Bitbucket repository within Electron")))),(0,r.kt)("h2",{id:"Testing-in-Chrome-and-Firefox-with-Cypress-Docker-Images"},"Testing in Chrome and Firefox with Cypress Docker Images"),(0,r.kt)("p",null,"The Cypress team maintains the official\n",(0,r.kt)("a",{parentName:"p",href:"https://github.com/cypress-io/cypress-docker-images"},"Docker Images")," for running\nCypress locally and in CI, which are built with Google Chrome and Firefox. For\nexample, this allows us to run the tests in Firefox by passing the\n",(0,r.kt)("inlineCode",{parentName:"p"},"--browser firefox")," attribute to ",(0,r.kt)("inlineCode",{parentName:"p"},"cypress run"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"image: cypress/browsers:node18.12.0-chrome106-ff106\n\npipelines:\n  default:\n    - step:\n        script:\n          # install dependencies\n          - npm ci\n          # start the server in the background\n          - npm run start &\n          # run Cypress tests in Firefox\n          - npx cypress run --browser firefox\n")),(0,r.kt)("h2",{id:"Caching-Dependencies-and-Build-Artifacts"},"Caching Dependencies and Build Artifacts"),(0,r.kt)("p",null,"Per the\n",(0,r.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/cache-dependencies/"},"Caches documentation"),",\n",(0,r.kt)("a",{parentName:"p",href:"https://bitbucket.com"},"Bitbucket")," offers options for caching dependencies and\nbuild artifacts across many different workflows."),(0,r.kt)("p",null,"To cache ",(0,r.kt)("inlineCode",{parentName:"p"},"node_modules"),", the npm cache across builds, the ",(0,r.kt)("inlineCode",{parentName:"p"},"cache")," attribute and\nconfiguration has been added below."),(0,r.kt)("p",null,"Artifacts from a job can be defined by providing paths to the ",(0,r.kt)("inlineCode",{parentName:"p"},"artifacts"),"\nattribute."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"image: cypress/browsers:node18.12.0-chrome106-ff106\n\npipelines:\n  default:\n    - step:\n        caches:\n          - node\n        script:\n          # install dependencies\n          - npm ci\n          # start the server in the background\n          - npm run start &\n          # run Cypress tests in Firefox\n          - npx cypress run --browser firefox\n        artifacts:\n          # store any generates images and videos as artifacts\n          - cypress/screenshots/**\n          - cypress/videos/**\n")),(0,r.kt)("p",null,"Using the\n",(0,r.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/configure-bitbucket-pipelinesyml/#Global-configuration-options"},"definitions"),"\nblock we can define additional caches for npm and Cypress."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"definitions:\n  caches:\n    npm: $HOME/.npm\n    cypress: $HOME/.cache/Cypress\n")),(0,r.kt)("h2",{id:"Parallelization"},"Parallelization"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/introduction"},"Cypress Cloud")," offers the ability to\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/smart-orchestration/parallelization"},"parallelize and group test runs"),"\nalong with additional insights and ",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/analytics"},"analytics")," for\nCypress tests."),(0,r.kt)("p",null,"Before diving into an example of a parallelization setup, it is important to\nunderstand the two different types of jobs that we will declare:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Install Job"),": A job that installs and caches dependencies that will be used\nby subsequent jobs later in the Bitbucket Pipelines workflow."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Worker Job"),": A job that handles execution of Cypress tests and depends on\nthe ",(0,r.kt)("em",{parentName:"li"},"install job"),".")),(0,r.kt)("h3",{id:"Install-Job"},"Install Job"),(0,r.kt)("p",null,"The separation of installation from test running is necessary when running\nparallel jobs. It allows for reuse of various build steps aided by caching."),(0,r.kt)("p",null,"First, we break the pipeline up into reusable chunks of configuration using a\n",(0,r.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/yaml-anchors/"},"YAML anchor"),",\n",(0,r.kt)("inlineCode",{parentName:"p"},"&e2e"),". This will be used by the worker jobs."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The following configuration using the ",(0,r.kt)("inlineCode",{parentName:"p"},"--parallel")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"--record")," flags to\n",(0,r.kt)("a",{parentName:"p",href:"/guides/guides/command-line#cypress-run"},"cypress run")," requires setting up\nrecording test results to ",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/introduction"},"Cypress Cloud"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"image: cypress/base:18.12.1\n\n## job definition for running E2E tests in parallel\ne2e: &e2e\n  name: E2E tests\n  caches:\n    - node\n    - cypress\n  script:\n    - npm run start &\n    - npm run e2e:record -- --parallel --group UI-Chrome --ci-build-id $BITBUCKET_BUILD_NUMBER\n  artifacts:\n    # store any generates images and videos as artifacts\n    - cypress/screenshots/**\n    - cypress/videos/**\n")),(0,r.kt)("h3",{id:"Worker-Jobs"},"Worker Jobs"),(0,r.kt)("p",null,"Next, the worker jobs under ",(0,r.kt)("inlineCode",{parentName:"p"},"pipelines")," that will run Cypress tests with Chrome\nin parallel."),(0,r.kt)("p",null,"We can use the ",(0,r.kt)("inlineCode",{parentName:"p"},"e2e"),"\n",(0,r.kt)("a",{parentName:"p",href:"https://support.atlassian.com/bitbucket-cloud/docs/yaml-anchors/"},"YAML anchor"),"\nin our definition of the pipeline to execute parallel jobs using the ",(0,r.kt)("inlineCode",{parentName:"p"},"parallel"),"\nattribute. This will allow us to run multiples instances of Cypress at same\ntime."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"## job definition for running E2E tests in parallel\n## ...\n\npipelines:\n  default:\n    - step:\n        name: Install dependencies\n        caches:\n          - npm\n          - cypress\n          - node\n        script:\n          - npm ci\n    - parallel:\n      # run N steps in parallel\n      - step:\n          <<: *e2e\n      - step:\n          <<: *e2e\n      - step:\n          <<: *e2e\ndefinitions:\n  caches:\n    npm: $HOME/.npm\n    cypress: $HOME/.cache/Cypress\n")),(0,r.kt)("p",null,"The complete ",(0,r.kt)("inlineCode",{parentName:"p"},"bitbucket-pipelines.yml")," is below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"image: cypress/base:18.12.1\n\n## job definition for running E2E tests in parallel\ne2e: &e2e\n  name: E2E tests\n  caches:\n    - node\n    - cypress\n  script:\n    - npm run start &\n    - npm run e2e:record -- --parallel --group UI-Chrome --ci-build-id $BITBUCKET_BUILD_NUMBER\n  artifacts:\n    # store any generates images and videos as artifacts\n    - cypress/screenshots/**\n    - cypress/videos/**\n\npipelines:\n  default:\n    - step:\n        name: Install dependencies\n        caches:\n          - npm\n          - cypress\n          - node\n        script:\n          - npm ci\n    - parallel:\n        # run N steps in parallel\n        - step:\n            <<: *e2e\n        - step:\n            <<: *e2e\n        - step:\n            <<: *e2e\ndefinitions:\n  caches:\n    npm: $HOME/.npm\n    cypress: $HOME/.cache/Cypress\n")),(0,r.kt)("h2",{id:"Using-Cypress-Cloud-with-Bitbucket-Pipelines"},"Using Cypress Cloud with Bitbucket Pipelines"),(0,r.kt)("p",null,"In the Bitbucket Pipelines configuration we have defined in the previous\nsection, we are leveraging three useful features of\n",(0,r.kt)("a",{parentName:"p",href:"/guides/cloud/introduction"},"Cypress Cloud"),":"),(0,r.kt)(d,{mdxType:"CiProviderCloudSteps"}))}h.isMDXComponent=!0}}]);