"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[2085],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>f});var r=n(7294);function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,s=function(e,t){if(null==e)return{};var n,r,s={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(s[n]=e[n]);return s}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,s=e.mdxType,a=e.originalType,l=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),u=p(n),d=s,f=u["".concat(l,".").concat(d)]||u[d]||m[d]||a;return n?r.createElement(f,i(i({ref:t},c),{},{components:n})):r.createElement(f,i({ref:t},c))}));function f(e,t){var n=arguments,s=t&&t.mdxType;if("string"==typeof e||s){var a=n.length,i=new Array(a);i[0]=d;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[u]="string"==typeof e?e:s,i[1]=o;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1820:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>a,metadata:()=>o,toc:()=>p});var r=n(7462),s=(n(7294),n(3905));const a={title:"Cypress.Promise"},i=void 0,o={unversionedId:"api/utilities/promise",id:"api/utilities/promise",title:"Cypress.Promise",description:"Cypress automatically includes",source:"@site/docs/api/utilities/promise.mdx",sourceDirName:"api/utilities",slug:"/api/utilities/promise",permalink:"/cypress-documentation/api/utilities/promise",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/api/utilities/promise.mdx",tags:[],version:"current",lastUpdatedAt:1696481464,formattedLastUpdatedAt:"Oct 5, 2023",frontMatter:{title:"Cypress.Promise"},sidebar:"api",previous:{title:"Cypress.minimatch",permalink:"/cypress-documentation/api/utilities/minimatch"},next:{title:"Cypress.sinon",permalink:"/cypress-documentation/api/utilities/sinon"}},l={},p=[{value:"Syntax",id:"Syntax",level:2},{value:"Usage",id:"Usage",level:3},{value:"Examples",id:"Examples",level:2},{value:"Basic Promise",id:"Basic-Promise",level:3},{value:"Waiting for Promises",id:"Waiting-for-Promises",level:3},{value:"Notes",id:"Notes",level:2},{value:"Rejected test promises do not fail tests",id:"Rejected-test-promises-do-not-fail-tests",level:3},{value:"See also",id:"See-also",level:2}],c=(u="Icon",function(e){return console.warn("Component "+u+" was not imported, exported, or provided by MDXProvider as global scope"),(0,s.kt)("div",e)});var u;const m={toc:p};function d(e){let{components:t,...n}=e;return(0,s.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,s.kt)("p",null,"Cypress automatically includes\n",(0,s.kt)("a",{parentName:"p",href:"https://github.com/petkaantonov/bluebird"},"Bluebird")," and exposes it as\n",(0,s.kt)("inlineCode",{parentName:"p"},"Cypress.Promise"),"."),(0,s.kt)("p",null,"Instantiate a new bluebird promise."),(0,s.kt)("h2",{id:"Syntax"},"Syntax"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"new Cypress.Promise(fn)\n")),(0,s.kt)("h3",{id:"Usage"},"Usage"),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},(0,s.kt)(c,{name:"check-circle",color:"green",mdxType:"Icon"})," Correct Usage")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"new Cypress.Promise((resolve, reject) => { ... })\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},(0,s.kt)(c,{name:"exclamation-triangle",color:"red",mdxType:"Icon"})," Incorrect Usage")),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"new cy.Promise(...)  // Errors, cannot be chained off 'cy'\n")),(0,s.kt)("h2",{id:"Examples"},"Examples"),(0,s.kt)("p",null,"Use ",(0,s.kt)("inlineCode",{parentName:"p"},"Cypress.Promise")," to create promises. Cypress is promise aware so if you\nreturn a promise from inside of commands like ",(0,s.kt)("a",{parentName:"p",href:"/api/commands/then"},(0,s.kt)("inlineCode",{parentName:"a"},".then()")),",\nCypress will not continue until those promises resolve."),(0,s.kt)("h3",{id:"Basic-Promise"},"Basic Promise"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"cy.get('button').then(($button) => {\n  return new Cypress.Promise((resolve, reject) => {\n    // do something custom here\n  })\n})\n")),(0,s.kt)("h3",{id:"Waiting-for-Promises"},"Waiting for Promises"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"it('waits for promises to resolve', () => {\n  let waited = false\n\n  function waitOneSecond() {\n    // return a promise that resolves after 1 second\n    return new Cypress.Promise((resolve, reject) => {\n      setTimeout(() => {\n        // set waited to true\n        waited = true\n\n        // resolve with 'foo' string\n        resolve('foo')\n      }, 1000)\n    })\n  }\n\n  cy.wrap(null).then(() => {\n    // return a promise to cy.then() that\n    // is awaited until it resolves\n    return waitOneSecond().then((str) => {\n      expect(str).to.eq('foo')\n      expect(waited).to.be.true\n    })\n  })\n})\n")),(0,s.kt)("h2",{id:"Notes"},"Notes"),(0,s.kt)("h3",{id:"Rejected-test-promises-do-not-fail-tests"},"Rejected test promises do not fail tests"),(0,s.kt)("p",null,"If the test code has an unhandled rejected promise, it does not automatically\nfail the test. If you do want to fail the test if there is an unhandled rejected\npromise in the test code you have to do one of two things:"),(0,s.kt)("p",null,"If you use ",(0,s.kt)("inlineCode",{parentName:"p"},"Cypress.Promise")," in your test code, register a callback using\nBluebird's API"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"Cypress.Promise.onPossiblyUnhandledRejection((error, promise) => {\n  throw error\n})\n")),(0,s.kt)("p",null,"If you use native built-in promises in your test code, register an event\nlistener on the test ",(0,s.kt)("inlineCode",{parentName:"p"},"window")," object:"),(0,s.kt)("pre",null,(0,s.kt)("code",{parentName:"pre",className:"language-javascript"},"window.addEventListener('unhandledrejection', (event) => {\n  throw event.reason\n})\n")),(0,s.kt)("p",null,(0,s.kt)("strong",{parentName:"p"},"Note:")," because this is the test ",(0,s.kt)("inlineCode",{parentName:"p"},"window")," object, such listeners are NOT reset\nbefore every test. You can register such listeners once using the ",(0,s.kt)("inlineCode",{parentName:"p"},"before")," hook\nin the spec file."),(0,s.kt)("h2",{id:"See-also"},"See also"),(0,s.kt)("ul",null,(0,s.kt)("li",{parentName:"ul"},(0,s.kt)("a",{parentName:"li",href:"/guides/references/bundled-libraries"},"Bundled Libraries")),(0,s.kt)("li",{parentName:"ul"},"The recipe ",(0,s.kt)("a",{parentName:"li",href:"/examples/recipes#Fundamentals"},"Handling errors"))))}d.isMDXComponent=!0}}]);