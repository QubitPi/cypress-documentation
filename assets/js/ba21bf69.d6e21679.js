"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[7404],{1739:(e,s,i)=>{i.r(s),i.d(s,{assets:()=>a,contentTitle:()=>o,default:()=>l,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var n=i(5893),t=i(1151);const r={title:"Cross Origin Testing"},o=void 0,c={id:"guides/guides/cross-origin-testing",title:"Cross Origin Testing",description:"As of Cypress v12.0.0, Cypress has the",source:"@site/docs/guides/guides/cross-origin-testing.mdx",sourceDirName:"guides/guides",slug:"/guides/guides/cross-origin-testing",permalink:"/guides/guides/cross-origin-testing",draft:!1,unlisted:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/guides/cross-origin-testing.mdx",tags:[],version:"current",lastUpdatedAt:1728611023,formattedLastUpdatedAt:"Oct 11, 2024",frontMatter:{title:"Cross Origin Testing"},sidebar:"guides",previous:{title:"Cross Browser Testing",permalink:"/guides/guides/cross-browser-testing"},next:{title:"Debugging",permalink:"/guides/guides/debugging"}},a={},d=[{value:"Parts of a URL",id:"Parts-of-a-URL",level:3},{value:"Other workarounds",id:"Other-workarounds",level:4}];function h(e){const s={a:"a",admonition:"admonition",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components},{DocsImage:i,DocumentDomainWorkaround:r,Icon:o}=s;return i||p("DocsImage",!0),r||p("DocumentDomainWorkaround",!0),o||p("Icon",!0),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(s.admonition,{type:"info",children:(0,n.jsxs)(s.p,{children:["As of Cypress ",(0,n.jsx)(s.a,{href:"https://on.cypress.io/changelog#12-0-0",children:"v12.0.0"}),", Cypress has the\ncapability to visit multiple origins in a single test via the\n",(0,n.jsx)(s.a,{href:"https://on.cypress.io/origin",children:"cy.origin()"})," command!"]})}),"\n",(0,n.jsxs)(s.p,{children:["Cypress limits each test to visiting domains that share the same superdomain. If\na navigation occurs that does not meet the same superdomain rule, the\n",(0,n.jsx)(s.a,{href:"/api/commands/origin",children:(0,n.jsx)(s.code,{children:"cy.origin()"})})," command must be used to execute Cypress\ncommands inside the newly navigated origin."]}),"\n",(0,n.jsxs)(s.p,{children:["But what is same superdomain? It is actually very similar to that of same\norigin! Two URLs have the same origin if the protocol, port (if specified), and\nhost match. Cypress automatically handles hosts of the same superdomain by\ninjecting the\n",(0,n.jsx)(s.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Document/domain",children:(0,n.jsx)(s.code,{children:"document.domain"})}),"\nproperty into the visited ",(0,n.jsx)(s.code,{children:"text/html"})," pages. This is why navigations without the\nuse of the ",(0,n.jsx)(s.a,{href:"/api/commands/origin",children:(0,n.jsx)(s.code,{children:"cy.origin()"})})," command are solely scope to the\nsame superdomain."]}),"\n",(0,n.jsx)(r,{}),"\n",(0,n.jsx)(s.p,{children:"We understand this is a bit complicated to understand, so we have built a nifty\nchart to help clarify the differences!"}),"\n",(0,n.jsx)(s.h3,{id:"Parts-of-a-URL",children:"Parts of a URL"}),"\n",(0,n.jsx)(i,{src:"/img/guides/cross-origin-testing/parts_of_a_url.jpg"}),"\n",(0,n.jsxs)(s.p,{children:["Given the URLs below, all have the same superdomain compared to\n",(0,n.jsx)(s.code,{children:"https://www.cypress.io"}),"."]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"https://cypress.io"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"https://docs.cypress.io"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.code,{children:"https://example.cypress.io/commands/querying"})}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["The URLs below, however, will have different superdomains/origins compared to\n",(0,n.jsx)(s.code,{children:"https://www.cypress.io"}),"."]}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"http://www.cypress.io"})," (Different protocol)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"https://docs.cypress.io:81"})," (Different port)"]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(s.code,{children:"https://www.auth0.com/"})," (Different host of different superdomain)"]}),"\n"]}),"\n",(0,n.jsxs)(s.p,{children:["The ",(0,n.jsx)(s.code,{children:"http://localhost"})," URLs differ if their ports are different. For example,\nthe ",(0,n.jsx)(s.code,{children:"http://localhost:3000"})," URL is considered to be a different origin from the\n",(0,n.jsx)(s.code,{children:"http://localhost:8080"})," URL."]}),"\n",(0,n.jsx)(s.p,{children:"The rules are:"}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(o,{name:"exclamation-triangle",color:"red"})," You ",(0,n.jsx)(s.strong,{children:"cannot"})," ",(0,n.jsx)(s.a,{href:"/api/commands/visit",children:"visit"}),"\ntwo domains of different superdomains in the same test and continue to interact\nwith the page without the use of the ",(0,n.jsx)(s.a,{href:"/api/commands/origin",children:(0,n.jsx)(s.code,{children:"cy.origin()"})})," command."]}),"\n",(0,n.jsxs)(s.li,{children:[(0,n.jsx)(o,{name:"check-circle",color:"green"})," You ",(0,n.jsx)(s.strong,{children:"can"})," ",(0,n.jsx)(s.a,{href:"/api/commands/visit",children:"visit"}),"\ntwo or more domains of different origin in ",(0,n.jsx)(s.strong,{children:"different"})," tests without needing\n",(0,n.jsx)(s.a,{href:"/api/commands/origin",children:(0,n.jsx)(s.code,{children:"cy.origin()"})}),"."]}),"\n"]}),"\n",(0,n.jsx)(s.p,{children:"For practical purposes, this means the following:"}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"// This test will run without error\nit('navigates', () => {\n  cy.visit('https://www.cypress.io')\n  cy.visit('https://docs.cypress.io')\n  cy.get('selector') // yup all good\n})\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"// this will error because cypress-dx.com doesn't match the cypress.io superdomain\nit('navigates', () => {\n  cy.visit('https://www.cypress.io')\n  cy.visit('https://www.cypress-dx.com')\n  cy.get('selector')\n})\n"})}),"\n",(0,n.jsxs)(s.p,{children:["To fix the above cross-origin error, use ",(0,n.jsx)(s.code,{children:"cy.origin()"})," to indicate which origin\nthe sequential command should run against:"]}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"it('navigates', () => {\n  cy.visit('https://example.cypress.io')\n  cy.visit('https://www.cypress-dx.com')\n  cy.origin('https://www.cypress-dx.com', () => {\n    cy.get('selector') // yup all good\n  })\n})\n"})}),"\n",(0,n.jsx)(s.pre,{children:(0,n.jsx)(s.code,{className:"language-javascript",children:"it('navigates', () => {\n  cy.visit('https://www.cypress.io')\n})\n\n// split visiting different origin in another test\nit('navigates to new origin', () => {\n  cy.visit('https://cypress-dx.com')\n  cy.get('selector') // yup all good\n})\n"})}),"\n",(0,n.jsxs)(s.p,{children:["This limitation exists because Cypress switches to the domain under each\nspecific test when it runs. For more information on this, please see our Web\nSecurity page regarding\n",(0,n.jsx)(s.a,{href:"/guides/guides/web-security#Different-superdomain-per-test-requires-cyorigin-command",children:"Different superdomain per test requires cy.origin command"}),"."]}),"\n",(0,n.jsx)(s.h4,{id:"Other-workarounds",children:"Other workarounds"}),"\n",(0,n.jsxs)(s.p,{children:["There are other ways of testing the interaction between two superdomains. The\nbrowser has a natural security barrier called ",(0,n.jsx)(s.code,{children:"origin policy"})," this means that\nstate like ",(0,n.jsx)(s.code,{children:"localStorage"}),", ",(0,n.jsx)(s.code,{children:"cookies"}),", ",(0,n.jsx)(s.code,{children:"service workers"})," and many other APIs are\nnot shared between them anyways. Cypress does offer APIs around ",(0,n.jsx)(s.code,{children:"localStorage"}),",\n",(0,n.jsx)(s.code,{children:"sessionStorage"}),", and ",(0,n.jsx)(s.code,{children:"cookies"})," that are not limited to this restriction."]}),"\n",(0,n.jsx)(s.p,{children:"As a best practice, you should not visit or interact with any website not under\nyour control."}),"\n",(0,n.jsxs)(s.p,{children:["If your organization uses Single Sign On (SSO) or OAuth then you might choose to\ntest a 3rd party service other than your superdomain, which can be tested with\n",(0,n.jsx)(s.a,{href:"/api/commands/origin",children:(0,n.jsx)(s.code,{children:"cy.origin()"})}),"."]}),"\n",(0,n.jsx)(s.p,{children:"We've written several other guides specifically about handling this situation."}),"\n",(0,n.jsxs)(s.ul,{children:["\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/guides/references/best-practices#Visiting-External-Sites",children:"Best Practices: Visiting external sites"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/guides/guides/web-security#Common-Workarounds",children:"Web Security: Common Workarounds"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/examples/recipes#Logging-In",children:"Recipes: Logging In - Single Sign On"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/guides/end-to-end-testing/amazon-cognito-authentication",children:"Guides: Amazon Cognito Authentication"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/guides/end-to-end-testing/auth0-authentication",children:"Guides: Auth0 Authentication"})}),"\n",(0,n.jsx)(s.li,{children:(0,n.jsx)(s.a,{href:"/guides/end-to-end-testing/okta-authentication",children:"Guides: Okta Authentication"})}),"\n"]})]})}function l(e={}){const{wrapper:s}={...(0,t.a)(),...e.components};return s?(0,n.jsx)(s,{...e,children:(0,n.jsx)(h,{...e})}):h(e)}function p(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},1151:(e,s,i)=>{i.d(s,{Z:()=>c,a:()=>o});var n=i(7294);const t={},r=n.createContext(t);function o(e){const s=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(r.Provider,{value:s},e.children)}}}]);