"use strict";(self.webpackChunkcypress_docusaurus_ts=self.webpackChunkcypress_docusaurus_ts||[]).push([[9785],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},h="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=r(e,["components","mdxType","originalType","parentName"]),h=d(n),p=o,m=h["".concat(l,".").concat(p)]||h[p]||u[p]||i;return n?a.createElement(m,s(s({ref:t},c),{},{components:n})):a.createElement(m,s({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,s=new Array(i);s[0]=p;var r={};for(var l in t)hasOwnProperty.call(t,l)&&(r[l]=t[l]);r.originalType=e,r[h]="string"==typeof e?e:o,s[1]=r;for(var d=2;d<i;d++)s[d]=n[d];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},354:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>s,default:()=>y,frontMatter:()=>i,metadata:()=>r,toc:()=>d});var a=n(7462),o=(n(7294),n(3905));const i={title:"Conditional Testing",sidebar_position:70},s=void 0,r={unversionedId:"guides/core-concepts/conditional-testing",id:"guides/core-concepts/conditional-testing",title:"Conditional Testing",description:"What you'll learn",source:"@site/docs/guides/core-concepts/conditional-testing.mdx",sourceDirName:"guides/core-concepts",slug:"/guides/core-concepts/conditional-testing",permalink:"/cypress-documentation/guides/core-concepts/conditional-testing",draft:!1,editUrl:"https://github.com/cypress-io/cypress-documentation/tree/main/docs/guides/core-concepts/conditional-testing.mdx",tags:[],version:"current",sidebarPosition:70,frontMatter:{title:"Conditional Testing",sidebar_position:70},sidebar:"guides",previous:{title:"Variables and Aliases",permalink:"/cypress-documentation/guides/core-concepts/variables-and-aliases"},next:{title:"Cypress App",permalink:"/cypress-documentation/guides/core-concepts/cypress-app"}},l={},d=[{value:"Definition",id:"Definition",level:2},{value:"The problem",id:"The-problem",level:2},{value:"The DOM is unstable",id:"The-DOM-is-unstable",level:3},{value:"The situations",id:"The-situations",level:2},{value:"Server side rendering",id:"Server-side-rendering",level:3},{value:"Client side rendering",id:"Client-side-rendering",level:3},{value:"The strategies",id:"The-strategies",level:2},{value:"A/B campaign <E2EOnlyBadge />",id:"AB-campaign",level:3},{value:"Use URL query params:",id:"Use-URL-query-params",level:4},{value:"Use the server:",id:"Use-the-server",level:4},{value:"Use session cookies:",id:"Use-session-cookies",level:4},{value:"Embed data in the DOM:",id:"Embed-data-in-the-DOM",level:4},{value:"Welcome wizard <E2EOnlyBadge />",id:"Welcome-wizard",level:3},{value:"Use the URL to control it:",id:"Use-the-URL-to-control-it",level:4},{value:"Use Cookies to know ahead of time:",id:"Use-Cookies-to-know-ahead-of-time",level:4},{value:"Use your server or database:",id:"Use-your-server-or-database",level:4},{value:"Embed data in DOM:",id:"Embed-data-in-DOM",level:4},{value:"Element existence",id:"Element-existence",level:3},{value:"Dynamic text",id:"Dynamic-text",level:3},{value:"Conditionally check whether an element has certain text:",id:"Conditionally-check-whether-an-element-has-certain-text",level:4},{value:"Error Recovery",id:"Error-Recovery",level:2}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)},h=c("Icon"),u=c("E2EOnlyBadge"),p=c("DocsImage"),m={toc:d};function y(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("h2",{parentName:"admonition",id:"What-youll-learn"},(0,o.kt)(h,{name:"graduation-cap",mdxType:"Icon"})," What you'll learn"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"When conditional testing is a good choice for your tests"),(0,o.kt)("li",{parentName:"ul"},"Situations where conditional testing is impossible"),(0,o.kt)("li",{parentName:"ul"},"Strategies to handle common scenarios of conditional testing"))),(0,o.kt)("h2",{id:"Definition"},"Definition"),(0,o.kt)("p",null,"Conditional testing refers to the common programming pattern:"),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"If X, then Y, else Z")),(0,o.kt)("p",null,"Many of our users ask how to accomplish this seemingly simple idiom in Cypress."),(0,o.kt)("p",null,"Here are some example use cases:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"How do I do something different whether an element does or doesn't exist?"),(0,o.kt)("li",{parentName:"ul"},"My application does A/B testing, how do I account for that?"),(0,o.kt)("li",{parentName:"ul"},"My users receive a \"welcome wizard\", but existing ones don't. Can I always\nclose the wizard in case it's shown, and ignore it when it's not?"),(0,o.kt)("li",{parentName:"ul"},"Can I recover from failed Cypress commands like if a\n",(0,o.kt)("a",{parentName:"li",href:"/api/commands/get"},"cy.get()")," doesn't find an element?"),(0,o.kt)("li",{parentName:"ul"},"I am trying to write dynamic tests that do something different based on the\ntext on the page."),(0,o.kt)("li",{parentName:"ul"},"I want to automatically find all ",(0,o.kt)("inlineCode",{parentName:"li"},"<a>")," elements and based on which ones I\nfind, I want to check that each link works.")),(0,o.kt)("p",null,"The problem is - while first appearing simple, writing tests in this fashion\noften leads to flaky tests, random failures, and difficult to track down edge\ncases."),(0,o.kt)("p",null,"Let's investigate why and how you can overcome these problems..."),(0,o.kt)("h2",{id:"The-problem"},"The problem"),(0,o.kt)("p",null,"These days modern JavaScript applications are highly dynamic and mutable. Their\nstate and the DOM are continuously changing over a period of time."),(0,o.kt)("p",null,"The problem with ",(0,o.kt)("strong",{parentName:"p"},"conditional testing")," is that it can only be used when the\nstate has stabilized. In modern day applications, knowing when state is stable\nis oftentimes impossible."),(0,o.kt)("p",null,"To a human - if something changes 10ms or 100ms from now, we may not even notice\nthis change and assume the state was always the same."),(0,o.kt)("p",null,"To a robot - even 10ms represents billions+ of clock cycles. The timescale\ndifference is incredible."),(0,o.kt)("p",null,"A human also has intuition. If you click a button and see a loading spinner, you\nwill assume the state is in flux and will automatically wait for it to finish."),(0,o.kt)("p",null,"A robot has no intuition - it will do exactly as it is programmed to do."),(0,o.kt)("p",null,"To illustrate this, let's take a straightforward example of trying to\nconditionally test unstable state."),(0,o.kt)("h3",{id:"The-DOM-is-unstable"},"The DOM is unstable"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// your app code\n\n// random amount of time\nconst random = Math.random() * 100\n\n// create a <button> element\nconst btn = document.createElement('button')\n\n// attach it to the body\ndocument.body.appendChild(btn)\n\nsetTimeout(() => {\n  // add the class active after an indeterminate amount of time\n  btn.setAttribute('class', 'active')\n}, random)\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// your cypress test code\nit('does something different based on the class of the button', () => {\n  // RERUN THIS TEST OVER AND OVER AGAIN\n  // AND IT WILL SOMETIMES BE TRUE, AND\n  // SOMETIMES BE FALSE.\n\n  cy.get('button').then(($btn) => {\n    if ($btn.hasClass('active')) {\n      // do something if it's active\n    } else {\n      // do something else\n    }\n  })\n})\n")),(0,o.kt)("p",null,"Do you see the problem here? This test is non-deterministic. The ",(0,o.kt)("inlineCode",{parentName:"p"},"<button>")," will\nsometimes have the class ",(0,o.kt)("inlineCode",{parentName:"p"},"active")," and sometimes not. In ",(0,o.kt)("strong",{parentName:"p"},"most")," cases, you\ncannot rely on the state of the DOM to determine what you should conditionally\ndo."),(0,o.kt)("p",null,"This is the heart of flaky tests. At Cypress we have designed our API to combat\nthis type of flakiness at every step."),(0,o.kt)("h2",{id:"The-situations"},"The situations"),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"only"),' way to do conditional testing on the DOM is if you are 100% sure\nthat the state has "settled" and there is no possible way for it to change.'),(0,o.kt)("p",null,"That is it! In any other circumstance you will have flaky tests if you try to\nrely on the state of the DOM for conditional testing."),(0,o.kt)("p",null,"Let's explore a few examples."),(0,o.kt)("h3",{id:"Server-side-rendering"},"Server side rendering"),(0,o.kt)("p",null,"If your application is server side rendered without JavaScript that\nasynchronously modifies the DOM - congratulations, you can do conditional\ntesting on the DOM!"),(0,o.kt)("p",null,"Why? Because if the DOM is not going to change after the ",(0,o.kt)("inlineCode",{parentName:"p"},"load")," event occurs,\nthen it can accurately represent a stable state of truth."),(0,o.kt)("p",null,"You can safely skip down to the bottom where we provide examples of conditional\ntesting."),(0,o.kt)("h3",{id:"Client-side-rendering"},"Client side rendering"),(0,o.kt)("p",null,"However, in most modern applications these days - when the ",(0,o.kt)("inlineCode",{parentName:"p"},"load")," event occurs,\nusually nothing has rendered on the screen. It is usually at this moment that\nyour scripts begin to load dynamic content and begin to render asynchronously."),(0,o.kt)("p",null,"Unfortunately, it is not possible for you to use the DOM to do conditional\ntesting. To do this would require you to know with 100% guarantee that your\napplication has finished all asynchronous rendering and that there are no\npending network requests, setTimeouts, intervals, postMessage, or async/await\ncode."),(0,o.kt)("p",null,"This is difficult to do (if not impossible) without making changes to your\napplication. You could use a library like\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/angular/angular/tree/master/packages/zone.js"},"Zone.js"),", but\neven that does not capture every async possibility."),(0,o.kt)("p",null,"In other words, you cannot do conditional testing safely if you want your tests\nto run 100% consistently."),(0,o.kt)("p",null,"But do not fret - there are better workarounds to still achieve conditional\ntesting ",(0,o.kt)("strong",{parentName:"p"},"without")," relying on the DOM. You have to ",(0,o.kt)("em",{parentName:"p"},"anchor")," yourself to another\npiece of truth that is not mutable."),(0,o.kt)("h2",{id:"The-strategies"},"The strategies"),(0,o.kt)("p",null,"If you are unable to guarantee that the DOM is stable - don't worry, there are\nother ways you can do conditional testing or work around the problems inherent\nwith it."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"You could:")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Remove the need to ever do conditional testing."),(0,o.kt)("li",{parentName:"ul"},"Force your application to behave deterministically."),(0,o.kt)("li",{parentName:"ul"},"Check other sources of truth (like your server or database)."),(0,o.kt)("li",{parentName:"ul"},"Embed data into other places (cookies / local storage) you could read off."),(0,o.kt)("li",{parentName:"ul"},"Add data to the DOM that you can read off to know how to proceed.")),(0,o.kt)("p",null,"Let's explore some examples of conditional testing that will pass or fail 100%\nof the time."),(0,o.kt)("h3",{id:"AB-campaign"},"A/B campaign ",(0,o.kt)(u,{mdxType:"E2EOnlyBadge"})),(0,o.kt)("admonition",{title:"What is A/B testing?",type:"info"},(0,o.kt)("p",{parentName:"admonition"},"A/B testing is a methodology for comparing two versions of a webpage or app against each other to determine which one\nperforms better. A/B testing is essentially an experiment where two or more variants of a page are shown to users at\nrandom, and statistical analysis is used to determine which variation performs better for a given conversion goal."),(0,o.kt)(p,{src:"/img/guides/core-concepts/ab-testing.png",alt:"Error loading ab-testing.png",mdxType:"DocsImage"})),(0,o.kt)("p",null,"In this example let's assume you visit your website and the content will be\ndifferent based on which A/B campaign your server decides to send. Perhaps it is\nbased on geo-location, IP address, time of day, locale, or other factors that\nare difficult to control. How can you write tests in this manner?"),(0,o.kt)("p",null,"Control which campaign gets sent, or provide a reliable means to know which one\nit is."),(0,o.kt)("h4",{id:"Use-URL-query-params"},"Use URL query params:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// tell your back end server which campaign you want sent\n// so you can deterministically know what it is ahead of time\ncy.visit('https://app.com?campaign=A')\n\n...\n\ncy.visit('https://app.com?campaign=B')\n\n...\n\ncy.visit('https://app.com?campaign=C')\n")),(0,o.kt)("p",null,"Now there is not even a need to do conditional testing since you are able to\nknow ahead of time what campaign was sent. Yes, this may require server side\nupdates, but you have to make an untestable app testable if you want to test it!"),(0,o.kt)("h4",{id:"Use-the-server"},"Use the server:"),(0,o.kt)("p",null,"Alternatively, if your server saves the campaign with a session, you could ask\nyour server to tell you which campaign you are on."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// this sends us the session cookies\ncy.visit('https://app.com')\n\n// assuming this sends us back\n// the campaign information\ncy.request('https://app.com/me')\n  .its('body.campaign')\n  .then((campaign) => {\n    // runs different cypress test code\n    // based on the type of campaign\n    return campaigns.test(campaign)\n  })\n")),(0,o.kt)("h4",{id:"Use-session-cookies"},"Use session cookies:"),(0,o.kt)("p",null,"Another way to test this is if your server sent the campaign in a session cookie\nthat you could read off."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"cy.visit('https://app.com')\ncy.getCookie('campaign').then((campaign) => {\n  return campaigns.test(campaign)\n})\n")),(0,o.kt)("h4",{id:"Embed-data-in-the-DOM"},"Embed data in the DOM:"),(0,o.kt)("p",null,"Another valid strategy would be to embed data directly into the DOM - but do so\nin a way where this data is ",(0,o.kt)("strong",{parentName:"p"},"always")," present and query-able. It would have to\nbe present 100% of the time, else this would not work."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"cy.get('html')\n  .should('have.attr', 'data-campaign')\n  .then((campaign) => {\n    return campaigns.test(campaign)\n  })\n")),(0,o.kt)("h3",{id:"Welcome-wizard"},"Welcome wizard ",(0,o.kt)(u,{mdxType:"E2EOnlyBadge"})),(0,o.kt)("p",null,'In this example, let\'s imagine you are running a bunch of tests and each time\nyou load your application, it may show a "Welcome Wizard" modal.'),(0,o.kt)("p",null,"In this situation, you want to close the wizard when it is present and ignore it\nif it is not."),(0,o.kt)("p",null,"The problem with this is that if the wizard renders asynchronously (as it likely\ndoes) you cannot use the DOM to conditionally dismiss it."),(0,o.kt)("p",null,"Once again - we will need another reliable way to achieve this without involving\nthe DOM."),(0,o.kt)("p",null,"These patterns are pretty much the same as before:"),(0,o.kt)("h4",{id:"Use-the-URL-to-control-it"},"Use the URL to control it:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// dont show the wizard\ncy.visit('https://app.com?wizard=0')\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// show the wizard\ncy.visit('https://app.com?wizard=1')\n")),(0,o.kt)("p",null,"We would likely need to update our client side code to check whether this query\nparam is present. Now we know ahead of time whether it will or will not be\nshown."),(0,o.kt)("h4",{id:"Use-Cookies-to-know-ahead-of-time"},"Use Cookies to know ahead of time:"),(0,o.kt)("p",null,"In the case where you cannot control it, you can still conditionally dismiss it\n",(0,o.kt)("strong",{parentName:"p"},"if")," you know whether it is going to be shown."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"cy.visit('https://app.com')\ncy.getCookie('showWizard')\n  .then((val) => {\n    if (val) {\n      // dismiss the wizard conditionally by enqueuing these\n      // three additional commands\n      cy.get('#wizard').contains('Close').click()\n    }\n  })\n\ncy.get(...)    // more commands here\n  .should(...) // more commands here\n  .click()     // more commands here\n")),(0,o.kt)("h4",{id:"Use-your-server-or-database"},"Use your server or database:"),(0,o.kt)("p",null,"If you store and/or persist whether to show the wizard on the server, then ask\nit."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"cy.visit('https://app.com')\ncy.request('https://app.com/me')\n  .its('body.showWizard')\n  .then((val) => {\n    if (val) {\n      // dismiss the wizard conditionally by enqueuing these\n      // three additional commands\n      cy.get('#wizard').contains('Close').click()\n    }\n  })\n\ncy.get(...)    // more commands here\n  .should(...) // more commands here\n  .click()     // more commands here\n")),(0,o.kt)("p",null,"Alternatively, if you are creating users, it might take less time to create the\nuser and set whether you want the wizard to be shown ahead of time. That would\navoid this check later."),(0,o.kt)("h4",{id:"Embed-data-in-DOM"},"Embed data in DOM:"),(0,o.kt)("p",null,"Another valid strategy would be to embed data directly into the DOM but to do so\nin a way that the data is ",(0,o.kt)("strong",{parentName:"p"},"always")," present and query-able. The data would have\nto be present 100% of the time, otherwise this strategy would not work."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"cy.get('html').should('have.attr', 'data-wizard').then((wizard) => {\n  if (wizard) {\n    // dismiss the wizard conditionally by enqueuing these\n    // three additional commands\n    cy.get('#wizard').contains('Close').click()\n  }\n})\n\ncy.get(...)    // more commands here\n  .should(...) // more commands here\n  .click()     // more commands here\n")),(0,o.kt)("h3",{id:"Element-existence"},"Element existence"),(0,o.kt)("p",null,"In the case where you ",(0,o.kt)("strong",{parentName:"p"},"are")," trying to use the DOM to do conditional testing,\nyou can utilize the ability to synchronously query for elements in Cypress to\ncreate control flow."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"In the event you did not read a word above and skipped down here, we will\nreiterate it one more time:"),(0,o.kt)("p",{parentName:"admonition"},"You cannot do conditional testing on the DOM unless you are either:"),(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},"Server side rendering with no asynchronous JavaScript."),(0,o.kt)("li",{parentName:"ul"},"Using client side JavaScript that ",(0,o.kt)("strong",{parentName:"li"},"only")," ever does synchronous rendering.")),(0,o.kt)("p",{parentName:"admonition"},"It is crucial that you understand how your application works else you will write\nflaky tests.")),(0,o.kt)("p",null,"Let's imagine we have a scenario where our application may do two separate\nthings that we are unable to control. In other words you tried every strategy\nabove and for whatever reason you were unable to know ahead of time what your\napplication will do."),(0,o.kt)("p",null,"Testing this in Cypress is possible."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// app code\n$('button').on('click', (e) => {\n  // do something synchronously randomly\n  if (Math.random() < 0.5) {\n    // append an input\n    $('<input />').appendTo($('body'))\n  } else {\n    // or append a textarea\n    $('<textarea />').appendTo($('body'))\n  }\n})\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// click the button causing the new\n// elements to appear\ncy.get('button').click()\ncy.get('body')\n  .then(($body) => {\n    // synchronously query from body\n    // to find which element was created\n    if ($body.find('input').length) {\n      // input was found, do something else here\n      return 'input'\n    }\n\n    // else assume it was textarea\n    return 'textarea'\n  })\n  .then((selector) => {\n    // selector is a string that represents\n    // the selector we could use to find it\n    cy.get(selector).type(`found the element by selector ${selector}`)\n  })\n")),(0,o.kt)("p",null,"We will reiterate one more time. Had the ",(0,o.kt)("inlineCode",{parentName:"p"},"<input>")," or the ",(0,o.kt)("inlineCode",{parentName:"p"},"<textarea>")," been\nrendered asynchronously, you could not use the pattern above. You would have to\ninvolve arbitrary delays which will not work in every situation, will slow down\nyour tests, and will still leave chances that your tests are flaky (and are an\nall-around anti-pattern)."),(0,o.kt)("p",null,"Cypress is built around creating ",(0,o.kt)("strong",{parentName:"p"},"reliable tests"),'. The secret to writing good\ntests is to provide as much "state" and "facts" to Cypress and to "guard it"\nfrom issuing new commands until your application has reached the desired state\nit needs to proceed.'),(0,o.kt)("p",null,"Doing conditional testing adds a huge problem - that the test writers themselves\nare unsure what the given state will be. In those situations, the only reliable\nway to have accurate tests is to embed this dynamic state in a reliable and\nconsistent way."),(0,o.kt)("p",null,"If you are not sure if you have written a potentially flaky test, there is a way\nto figure it out. Repeat the test an excessive number of times, and then repeat\nby modifying the Developer Tools to throttle the Network and the CPU. This will\ncreate different loads that simulate different environments (like CI). If you've\nwritten a good test, it will pass or fail 100% of the time."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"Cypress._.times(100, (i) => {\n  it(`num ${i + 1} - test the thing conditionally`, () => {\n    // do the conditional bits 100 times\n  })\n})\n")),(0,o.kt)("h3",{id:"Dynamic-text"},"Dynamic text"),(0,o.kt)("p",null,"The pattern of doing something conditionally based on whether or not certain\ntext is present is identical to element existence above."),(0,o.kt)("h4",{id:"Conditionally-check-whether-an-element-has-certain-text"},"Conditionally check whether an element has certain text:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"// this only works if there's 100% guarantee\n// body has fully rendered without any pending changes\n// to its state\ncy.get('body').then(($body) => {\n    // synchronously ask for the body's text\n    // and do something based on whether it includes\n    // another string\n    if ($body.text().includes('some string')) {\n      // yup found it\n      cy.get(...).should(...)\n    } else {\n      // nope not here\n      cy.get(...).should(...)\n    }\n  })\n")),(0,o.kt)("h2",{id:"Error-Recovery"},"Error Recovery"),(0,o.kt)("p",null,"Many of our users ask how they can recover from failed commands."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"If I had error handling, I could try to find X and if X fails go find Y")),(0,o.kt)("p",null,"Because error handling is a common idiom in most programming languages, and\nespecially in Node, it seems reasonable to expect to do that in Cypress."),(0,o.kt)("p",null,"However, this is really the same question as asking to do conditional testing,\nbut wrapped up in a slightly different implementation detail."),(0,o.kt)("p",null,"For instance you may want to do this:"),(0,o.kt)("admonition",{type:"danger"},(0,o.kt)(h,{name:"exclamation-triangle",color:"red",mdxType:"Icon"})," The following code is not valid."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//! You cannot add error handling to Cypress commands\n//! This code is just for demonstration purposes\ncy.get('button')\n  .contains('hello')\n  .catch((err) => {\n    // oh no the button wasn't found\n    // (or something else failed)\n    cy.get('somethingElse').click()\n  })\n")),(0,o.kt)("p",null,"If you've been reading along, then you should already have a grasp on why trying\nto implement conditional code with asynchronous rendering is not a good idea. If\nthe test writer cannot accurately predict the given state of the system, then\nneither can Cypress. Error handling offers no additional proof this can be done\ndeterministically."),(0,o.kt)("p",null,"You should think of failed commands in Cypress as akin to uncaught exceptions in\nserver side code. It is not possible to try to recover in those scenarios\nbecause the system has transitioned to an unreliable state. Instead you\ngenerally always opt to crash and log. When Cypress fails the test - that is\nexactly what it is doing. Bailing out, skipping any remaining commands in the\ntest, and logging out the failure."),(0,o.kt)("p",null,"But... for the sake of the argument, let's imagine for a moment you did have\nerror handling in Cypress."),(0,o.kt)("p",null,"Enabling this would mean that for every single command, it would recover from\nerrors, but only after each applicable command timeout was reached. Since\ntimeouts start at 4 seconds (and exceed from there), this means that it would\nonly fail after a long, long time."),(0,o.kt)("p",null,'Let\'s reimagine our "Welcome Wizard" example from before.'),(0,o.kt)("admonition",{type:"danger"},(0,o.kt)(h,{name:"exclamation-triangle",color:"red",mdxType:"Icon"})," The following code is not valid."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"//! You cannot add error handling to Cypress commands.\n//! This code is just for demonstration purposes\nfunction keepCalmAndCarryOn () {\n  cy.get(...).should(...).click()\n}\n\ncy\n  .get('#wizard').contains('Close').click()\n  .catch((err) => {\n    // no problem, i guess the wizard didn't exist\n    // or something... no worries\n    keepCalmAndCarryOn()\n  })\n  .then(keepCalmAndCarryOn)\n")),(0,o.kt)("p",null,"In the ",(0,o.kt)("strong",{parentName:"p"},"best")," case scenario, we have wasted at LEAST 4 seconds waiting on the\n",(0,o.kt)("inlineCode",{parentName:"p"},"<#wizard>")," element to possibly exist before we errored and continued on."),(0,o.kt)("p",null,"But in the ",(0,o.kt)("strong",{parentName:"p"},"worst")," case scenario we have a situation where the ",(0,o.kt)("inlineCode",{parentName:"p"},"<#wizard>"),"\n",(0,o.kt)("strong",{parentName:"p"},"was")," going to be rendered, but it didn't render within our given timeout.\nLet's assume this was due to a pending network request or WebSocket message or a\nqueued timer, or anything else."),(0,o.kt)("p",null,"In this situation, not only did we wait a long period of time, but when the\n",(0,o.kt)("inlineCode",{parentName:"p"},"<#wizard>")," element was eventually shown it's likely caused an error downstream\non other commands."),(0,o.kt)("p",null,"If you cannot accurately know the state of your application then no matter what\nprogramming idioms you have available - ",(0,o.kt)("strong",{parentName:"p"},"you cannot write 100% deterministic\ntests"),"."))}y.isMDXComponent=!0}}]);